<div class="table-container">
  <div>
    <h1>Driver's Database</h1>
    <button class="add-button" (click)="openModal()">
      <img src="icons/plussign.svg" alt="" />Add New Driver
    </button>
  </div>
  <ul class="table-tabs">
    <li
      *ngFor="let tab of tabs; let i = index"
      class="tab"
      [class.active]="activeTab === i"
      (click)="setActiveTab(i)"
    >
      {{ tab }}
    </li>
  </ul>

  <label class="search-label">
    <div class="search-wrapper">
      <input
        #searchInput
        type="search"
        placeholder="Search"
        (input)="onSearchChange(searchInput.value)"
      />
      <img src="icons/search.svg" alt="" />
    </div>
  </label>

  <table class="carrequest-table">
    <thead>
      <tr>
        <td>Driver</td>
        <td>Assigned car</td>
        <td>Plate Number</td>
        <td></td>
      </tr>
    </thead>
    <tbody class="table-body">
      @for (item of filteredDrivers; track item.id) {
      <tr>
        <td>
          <div style="display: flex; align-items: center; gap: 8px">
            <img
              [src]="item.driverpng || 'path/to/default/driver.png'"
              alt="Driver"
            />
            <span>
              {{ item.driversName }}
            </span>
          </div>
        </td>
        <td>
          @if(item.carModel) {
          <div style="display: flex; align-items: center; gap: 8px">
            <img src="icons/carpng.png" width="30px" height="30px" alt="Car" />
            <span>
              {{ item.carModel }}
            </span>
          </div>
          } @else {
          <span>-</span>
          }
        </td>
        <td>
          {{ item.plateNumber || "-" }}
        </td>

        <td>
          <div class="more-options" (click)="toggleDropdown(item, $event)">
            <img src="icons/dots.svg" alt="More" />
            @if(activeDropdownId === item.id) {
            <div class="dropdown-menu">
              <div
                class="dropdown-item"
                (click)="editDriver(item); $event.stopPropagation()"
              >
                <img src="icons/edit.svg" alt="Edit" />
                <span>Edit driver</span>
              </div>
              <div
                class="dropdown-item delete"
                (click)="deleteDriver(item); $event.stopPropagation()"
              >
                <img src="icons/delete.svg" alt="Delete" />
                <span>Delete driver</span>
              </div>
            </div>
            }
          </div>
        </td>
      </tr>
      } @empty {
      <tr>
        <td colspan="4" style="text-align: center; padding: 20px">
          No drivers found matching your criteria.
        </td>
      </tr>
      }
    </tbody>
  </table>
</div>

<app-add-driver-modal
  #addDriverModal
  (driverAdded)="onDriverAdded($event)"
></app-add-driver-modal>

<app-delete-modal
  [isOpen]="isDeleteModalOpen"
  (confirmDelete)="onConfirmDelete()"
  (cancelDelete)="isDeleteModalOpen = false"
></app-delete-modal>
