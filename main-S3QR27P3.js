import{a as ba,b as Ta,c as Vn,d as Gn,e as qn,f as Aa,g as gt,h as Hn,i as Kn,j as $n,k as zn,l as Qn,m as Yn,n as Jn,o as mt,p as Na}from"./chunk-MRKZ2YPY.js";import"./chunk-KWOXLBWR.js";import{$ as _l,A as Ya,B as Ja,C as Zn,D as _s,E as Xa,F as Te,G as Za,H as el,I as tl,J as nl,K as il,L as sl,M as rl,N as ol,O as al,P as ei,Q as ll,R as gs,S as ms,T as cl,U as ul,V as hl,W as dl,X as fl,Y as pl,Z as ys,_ as vs,a as Pa,aa as gl,b as Ra,ba as Cs,c as xa,ca as ml,d as yt,da as yl,e as ka,ea as vl,f as Da,fa as Cl,g as Oa,ga as wl,h as Ma,ha as El,i as Fa,ia as Il,j as La,ja as Sl,k as Ua,ka as bl,l as Wa,m as $t,ma as Tl,n as fs,o as Ba,p as Xn,q as ps,r as ja,s as Va,t as Ga,ta as Al,u as qa,v as Ha,w as Ka,x as $a,y as za,z as Qa}from"./chunk-ZAIJA77U.js";import{$a as zo,Ab as Ia,Bb as Sa,C as Uo,Da as te,Ea as jo,F as me,G as Ve,H as $,I as _,Ia as Q,J as de,Ja as Vo,M as Wo,N as ut,Na as ls,P as kn,Pa as Go,Q as Dn,R as os,Va as qo,W as j,Wa as Ho,Ya as Ko,Z as Ge,Za as cs,_a as $o,a as No,ab as Qo,b as Po,ba as z,bb as Yo,c as Rn,ca as Bo,cb as Jo,e as xn,ea as as,eb as Fn,f as Ro,fa as ht,fb as Xo,g as xo,ga as qe,gb as ft,hb as Zo,i as rt,ib as ea,j as Z,ja as Vt,jb as ta,k as A,kb as na,l as ko,lb as F,ma as ee,mb as xe,n as rs,o as ot,oa as Gt,p as Do,pb as _t,q as at,s as Oo,t as lt,ta as I,tb as ya,u as je,ua as k,ub as va,v as Mo,va as D,vb as jn,w as Fo,wa as On,wb as Ca,x as Lo,xa as Mn,y as ct,ya as dt,yb as wa,z as be,zb as Ea}from"./chunk-BI4CKXZS.js";import"./chunk-RYKC2KYQ.js";import{b as ws}from"./chunk-3ZSIHJGM.js";import{a as ae}from"./chunk-5OH3PL7V.js";import{$ as Re,F as Ln,G as O,H as la,I as ca,J as oe,K as Pe,L as Un,M as qt,N as ua,O as ha,R as da,T as m,U as Y,V as M,W as hs,X as fa,Y as Ht,_ as W,a as X,aa as Wn,b as ge,ba as ds,ca as pa,d as st,da as Bn,e as f,f as pt,g as ia,h as sa,ia as _a,j as ra,ka as ga,la as ma,p as V,q as oa,qa as Kt,s as us,w as aa,y as ye}from"./chunk-BSE6HB5W.js";var Pl=A(n=>!!n),Rl=(()=>{class n{router;auth;constructor(t,i){this.router=t,this.auth=i}canActivate=(t,i)=>{let s=t.data.authGuardPipe||(()=>Pl);return Ea(this.auth).pipe(Do(1),s(t,i),A(r=>typeof r=="boolean"?r:Array.isArray(r)?this.router.createUrlTree(r):this.router.parseUrl(r)))};static \u0275fac=function(i){return new(i||n)(_(ft),_(Ca))};static \u0275prov=me({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var xl=n=>Po(Pl,A(e=>e||n));var Ah=n=>({closed:n}),Nh=()=>["/settings"],Dl=()=>({}),Ph=()=>({"justify-content":"center"}),Rh=()=>({"justify-content":"space-between"}),xh=()=>["/dashboard"],kh=()=>["/kmreports"],Dh=()=>["/maintenance"],Oh=()=>["/damage-report"],Mh=()=>["/request-new-car"],Fh=()=>["/cardatabase"],Lh=()=>["/carrequests"],Uh=()=>["/driversdatabase"];function Wh(n,e){if(n&1){let t=On();I(0,"div",3),os(),I(1,"svg",10),Mn("click",function(){kn(t);let s=dt();return Dn(s.toggleSidebar())}),D(2,"path",11),k()()}if(n&2){let t=dt();ee("ngStyle",t.isClosed?Q(1,Dl):Q(2,Ph))}}function Bh(n,e){if(n&1){let t=On();I(0,"div",3)(1,"a",12),D(2,"img",13),k(),os(),I(3,"svg",14),Mn("click",function(){kn(t);let s=dt();return Dn(s.toggleSidebar())}),D(4,"path",11),k()()}if(n&2){let t=dt();ee("ngStyle",t.isClosed?Q(1,Dl):Q(2,Rh))}}function jh(n,e){n&1&&(I(0,"li",15),D(1,"img",16),I(2,"a"),te(3,"Dashboard"),k()(),I(4,"li",15),D(5,"img",17),I(6,"a"),te(7,"Km Report"),k()(),I(8,"li",15),D(9,"img",18),I(10,"a"),te(11,"Maintenance History"),k()(),I(12,"li",15),D(13,"img",19),I(14,"a"),te(15,"Damage Report"),k()(),I(16,"li",15),D(17,"img",20),I(18,"a"),te(19,"Request New Car"),k()()),n&2&&(ee("routerLink",Q(5,xh)),z(4),ee("routerLink",Q(6,kh)),z(4),ee("routerLink",Q(7,Dh)),z(4),ee("routerLink",Q(8,Oh)),z(4),ee("routerLink",Q(9,Mh)))}function Vh(n,e){n&1&&(I(0,"li",15),D(1,"img",21),I(2,"a"),te(3,"Car Database"),k()(),I(4,"li",15),D(5,"img",20),I(6,"a"),te(7,"Car Requests"),k()(),I(8,"li",15),D(9,"img",22),I(10,"a"),te(11,"Drivers Database"),k()()),n&2&&(ee("routerLink",Q(3,Fh)),z(4),ee("routerLink",Q(4,Lh)),z(4),ee("routerLink",Q(5,Uh)))}function Gh(n,e){if(n&1&&(I(0,"span"),te(1),k()),n&2){let t=dt();z(),jo(t.userName)}}function qh(n,e){n&1&&(I(0,"span"),te(1,"Guest"),k())}function Hh(n,e){n&1&&Vt(0,qh,2,0,"ng-template",null,0,ls)}function Kh(n,e){n&1&&(I(0,"span"),te(1,"Guest"),k())}var ti=class n{constructor(e,t){this.authService=e;this.router=t}isClosed=!1;userName=null;isAdmin=!1;subscriptions=new No;ngOnInit(){let e=this.authService.userName$.subscribe(i=>{this.userName=i}),t=this.authService.isAdmin$.subscribe(i=>{this.isAdmin=i});this.subscriptions.add(e),this.subscriptions.add(t)}ngOnDestroy(){this.subscriptions.unsubscribe()}toggleSidebar(){this.isClosed=!this.isClosed}logout(){this.authService.logout(),this.userName=null,this.router.navigate(["/auth/login"])}static \u0275fac=function(t){return new(t||n)(as(Sa),as(ft))};static \u0275cmp=ht({type:n,selectors:[["app-sidemenu"]],decls:20,vars:9,consts:[["guest",""],[1,"sidebar",3,"ngClass"],[1,"logo"],[1,"align-icon-arrow",3,"ngStyle"],[1,"menu"],["routerLinkActive","active",1,"settings",3,"routerLink"],["src","icons/settings.svg","alt","image",1,"settingsicon"],[1,"user-profile"],["src","icons/driver.png","alt","User"],["id","logouticon","src","icons/logout.svg","alt","Logout",2,"cursor","pointer",3,"click"],["width","16","height","14","viewBox","0 0 16 14","fill","none","xmlns","http://www.w3.org/2000/svg",1,"arrow-hover",2,"transform","rotate(180deg)",3,"click"],["d","M15 7.00008H1M1 7.00008L6.83333 1.16675M1 7.00008L6.83333 12.8334","stroke","black","stroke-width","1.2","stroke-linecap","round","stroke-linejoin","round"],["href",""],["src","icons/axians.png","alt","Axians Logo",2,"padding","10px"],["width","16","height","14","viewBox","0 0 16 14","fill","none","xmlns","http://www.w3.org/2000/svg",1,"arrow-hover",2,"transform","rotate(0deg)",3,"click"],["routerLinkActive","active",3,"routerLink"],["src","icons/dashboard.svg","alt","",1,"dashboardicon"],["src","icons/kmreport.svg","alt","",1,"kmreporticon"],["src","icons/maintenance.svg","alt","",1,"maintenanceicon"],["src","icons/damage.svg","alt","",1,"damageicon"],["src","icons/request.svg","alt","",1,"requesticon"],["src","icons/car.svg","alt","",1,"requesticon"],["src","icons/datastorage.svg","alt","",1,"requesticon"]],template:function(t,i){if(t&1){let s=On();I(0,"nav")(1,"div",1)(2,"div",2),Vt(3,Wh,3,3,"div",3)(4,Bh,5,3,"div",3),k(),D(5,"div"),I(6,"ul",4),Vt(7,jh,20,10)(8,Vh,12,6),k(),I(9,"div",5),D(10,"img",6),I(11,"a"),te(12,"Settings"),k()(),I(13,"div",7),D(14,"img",8),Vt(15,Gh,2,1,"span")(16,Hh,2,0)(17,Kh,2,0,"ng-template",null,0,ls),I(19,"img",9),Mn("click",function(){return kn(s),Dn(i.logout())}),k()()()()}t&2&&(z(),ee("ngClass",Vo(6,Ah,i.isClosed)),z(2),Gt(i.isClosed?3:4),z(4),Gt(i.isAdmin?-1:7),z(),Gt(i.isAdmin?8:-1),z(),ee("routerLink",Q(8,Nh)),z(6),Gt(i.userName?15:16))},dependencies:[Ko,qo,Ho,na,Zo,ea],styles:['@font-face{font-family:Poppins;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiEyp8kv8JHgFVrJJbecmNE.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiEyp8kv8JHgFVrJJnecmNE.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiEyp8kv8JHgFVrJJfecg.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Poppins;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLCz7Z11lFc-K.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLCz7Z1JlFc-K.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLCz7Z1xlFQ.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}nav[_ngcontent-%COMP%]{position:fixed;font-family:Poppins,sans-serif;margin:0;padding:0;background-color:#f4f4f4}#arrowicon[_ngcontent-%COMP%]{position:absolute;top:2px;right:10px;width:40px;height:30px;cursor:pointer}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#fff;border-right:1px solid rgb(245,236,236);display:flex;flex-direction:column;padding:10px;position:relative;transition:width .5s}.sidebar.closed[_ngcontent-%COMP%]{width:40px;overflow:hidden}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px}.logo.hidden[_ngcontent-%COMP%]{display:none}.menu[_ngcontent-%COMP%]{list-style-type:none;padding:0;flex-grow:1;margin-top:8%}.menu[_ngcontent-%COMP%]   li.sidebar.closed[_ngcontent-%COMP%]{display:none}.sidebar.closed[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:10px;margin-right:0;margin-top:20px}.sidebar.closed[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:12px 10px;margin-top:40px}.sidebar.closed[_ngcontent-%COMP%]   .settings[_ngcontent-%COMP%], .sidebar.closed[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]{padding:10px;margin-top:20px}.sidebar.closed[_ngcontent-%COMP%]   #arrowicon[_ngcontent-%COMP%]{left:10px;top:10px}.sidebar.closed[_ngcontent-%COMP%]   menu[_ngcontent-%COMP%]{margin-top:10%}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 15px;cursor:pointer;border-radius:5px;transition:background .3s;margin-bottom:8px}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover, .menu[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{background:#1e72c033}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:12px;font-size:18px}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#000;font-size:16px}.settings[_ngcontent-%COMP%]{display:flex;align-items:center;padding:10px 15px;cursor:pointer;text-decoration:none;color:#000;font-size:16px}.settings[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:10px}.settings[_ngcontent-%COMP%]:hover{transition:.5s;background:#1e72c033}.settings[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#000;font-size:16px;margin-left:10px}.user-profile[_ngcontent-%COMP%]{display:flex;align-items:center;padding:15px;border-top:1px solid #ddd;margin-top:auto}.user-profile[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:44px;height:40px;border-radius:50%;margin-right:10px}.sidebar.closed[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;margin-right:10px;margin-left:-8px}.user-profile[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex-grow:1}.user-profile[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px;cursor:pointer}.kmreporticon[_ngcontent-%COMP%], .dashboardicon[_ngcontent-%COMP%], .maintenanceicon[_ngcontent-%COMP%], .damageicon[_ngcontent-%COMP%], .requesticon[_ngcontent-%COMP%]{margin-right:17px}.settingsicon[_ngcontent-%COMP%]{width:35px;height:50px}#logouticon[_ngcontent-%COMP%]{width:24px;height:30px;cursor:pointer;position:absolute;right:15px}.sidebar.closed[_ngcontent-%COMP%]   #logouticon[_ngcontent-%COMP%]{display:none}.arrow-hover[_ngcontent-%COMP%]{padding:10px;display:flex;cursor:pointer}.arrow-hover[_ngcontent-%COMP%]:hover{padding:10px;display:flex;cursor:pointer;background-color:#f5f5f5}.align-icon-arrow[_ngcontent-%COMP%]{display:flex;cursor:pointer}']})};var ni=class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=ht({type:n,selectors:[["app-base"]],decls:4,vars:0,consts:[[1,"axi-cars"],[1,"content"]],template:function(t,i){t&1&&(I(0,"div",0),D(1,"app-sidemenu"),I(2,"div",1),D(3,"router-outlet"),k()())},dependencies:[ti,Fn],styles:[".content[_ngcontent-%COMP%]{position:relative;margin-left:300px}"]})};var $h=()=>xl(["auth","login"]),Ol=[{path:"auth",loadChildren:()=>import("./chunk-PR2PPMET.js")},{path:"",component:ni,canActivate:[Rl],data:{authGuardPipe:$h},loadChildren:()=>import("./chunk-U2SODANA.js").then(n=>n.default)},{path:"",redirectTo:"home",pathMatch:"full"}];var zh="@firebase/firestore-compat",Qh="0.3.45";function As(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new yt("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Ml(){if(typeof Uint8Array>"u")throw new yt("unimplemented","Uint8Arrays are not available in this environment.")}function Fl(){if(!Ma())throw new yt("unimplemented","Blobs are unavailable in Firestore in this environment.")}var ii=class n{constructor(e){this._delegate=e}static fromBase64String(e){return Fl(),new n(Zn.fromBase64String(e))}static fromUint8Array(e){return Ml(),new n(Zn.fromUint8Array(e))}toBase64(){return Fl(),this._delegate.toBase64()}toUint8Array(){return Ml(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Es(n){return Yh(n,["next","error","complete"])}function Yh(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}var Is=class{enableIndexedDbPersistence(e,t){return qa(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Ha(e._delegate)}clearIndexedDbPersistence(e){return Ka(e._delegate)}},si=class{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof Fa||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ra("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,i={}){Wa(this._delegate,e,t,i)}enableNetwork(){return za(this._delegate)}disableNetwork(){return Qa(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,La("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return $a(this._delegate)}onSnapshotsInSync(e){return ml(this._delegate,e)}get app(){if(!this._appCompat)throw new yt("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Et(this,fs(this._delegate,e))}catch(t){throw G(t,"collection()","Firestore.collection()")}}doc(e){try{return new ve(this,Xn(this._delegate,e))}catch(t){throw G(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ze(this,Ba(this._delegate,e))}catch(t){throw G(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Cl(this._delegate,t=>e(new ri(this,t)))}batch(){return Ga(this._delegate),new oi(new vl(this._delegate,e=>yl(this._delegate,e)))}loadBundle(e){return Ya(this._delegate,e)}namedQuery(e){return Ja(this._delegate,e).then(t=>t?new ze(this,t):null)}},Ct=class extends al{constructor(e){super(),this.firestore=e}convertBytes(e){return new ii(new Zn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return ve.forKey(t,this.firestore,null)}};function Jh(n){Pa(n)}var ri=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ct(e)}get(e){let t=He(e);return this._delegate.get(t).then(i=>new Ke(this._firestore,new ei(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){let s=He(e);return i?(As("Transaction.set",i),this._delegate.set(s,t,i)):this._delegate.set(s,t),this}update(e,t,i,...s){let r=He(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,i,...s),this}delete(e){let t=He(e);return this._delegate.delete(t),this}},oi=class{constructor(e){this._delegate=e}set(e,t,i){let s=He(e);return i?(As("WriteBatch.set",i),this._delegate.set(s,t,i)):this._delegate.set(s,t),this}update(e,t,i,...s){let r=He(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,i,...s),this}delete(e){let t=He(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},wt=class n{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){let i=new ll(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new $e(this._firestore,i),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let i=n.INSTANCES,s=i.get(e);s||(s=new WeakMap,i.set(e,s));let r=s.get(t);return r||(r=new n(e,new Ct(e),t),s.set(t,r)),r}};wt.INSTANCES=new WeakMap;var ve=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ct(e)}static forPath(e,t,i){if(e.length%2!==0)throw new yt("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new $t(t._delegate,i,new Oa(e)))}static forKey(e,t,i){return new n(t,new $t(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new Et(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Et(this.firestore,fs(this._delegate,e))}catch(t){throw G(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=W(e),e instanceof $t?ps(this._delegate,e):!1}set(e,t){t=As("DocumentReference.set",t);try{return t?ys(this._delegate,e,t):ys(this._delegate,e)}catch(i){throw G(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return arguments.length===1?vs(this._delegate,e):vs(this._delegate,e,t,...i)}catch(s){throw G(s,"updateDoc()","DocumentReference.update()")}}delete(){return _l(this._delegate)}onSnapshot(...e){let t=Ll(e),i=Ul(e,s=>new Ke(this.firestore,new ei(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return Cs(this._delegate,t,i)}get(e){let t;return e?.source==="cache"?t=ul(this._delegate):e?.source==="server"?t=hl(this._delegate):t=cl(this._delegate),t.then(i=>new Ke(this.firestore,new ei(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(wt.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function G(n,e,t){return n.message=n.message.replace(e,t),n}function Ll(n){for(let e of n)if(typeof e=="object"&&!Es(e))return e;return{}}function Ul(n,e){var t,i;let s;return Es(n[0])?s=n[0]:Es(n[1])?s=n[1]:typeof n[0]=="function"?s={next:n[0],error:n[1],complete:n[2]}:s={next:n[1],error:n[2],complete:n[3]},{next:r=>{s.next&&s.next(e(r))},error:(t=s.error)===null||t===void 0?void 0:t.bind(s),complete:(i=s.complete)===null||i===void 0?void 0:i.bind(s)}}var Ke=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new ve(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return ms(this._delegate,e._delegate)}},$e=class extends Ke{data(e){let t=this._delegate.data(e);return this._delegate._converter||xa(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},ze=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ct(e)}where(e,t,i){try{return new n(this.firestore,Te(this._delegate,Za(e,t,i)))}catch(s){throw G(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,Te(this._delegate,el(e,t)))}catch(i){throw G(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,Te(this._delegate,tl(e)))}catch(t){throw G(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,Te(this._delegate,nl(e)))}catch(t){throw G(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,Te(this._delegate,il(...e)))}catch(t){throw G(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,Te(this._delegate,sl(...e)))}catch(t){throw G(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,Te(this._delegate,rl(...e)))}catch(t){throw G(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,Te(this._delegate,ol(...e)))}catch(t){throw G(t,"endAt()","Query.endAt()")}}isEqual(e){return ja(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=fl(this._delegate):e?.source==="server"?t=pl(this._delegate):t=dl(this._delegate),t.then(i=>new zt(this.firestore,new gs(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){let t=Ll(e),i=Ul(e,s=>new zt(this.firestore,new gs(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return Cs(this._delegate,t,i)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(wt.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Ss=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new $e(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},zt=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ze(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new $e(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Ss(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new $e(this._firestore,i))})}isEqual(e){return ms(this._delegate,e._delegate)}},Et=class n extends ze{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new ve(this.firestore,e):null}doc(e){try{return e===void 0?new ve(this.firestore,Xn(this._delegate)):new ve(this.firestore,Xn(this._delegate,e))}catch(t){throw G(t,"doc()","CollectionReference.doc()")}}add(e){return gl(this._delegate,e).then(t=>new ve(this.firestore,t))}isEqual(e){return ps(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(wt.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function He(n){return Ua(n,$t)}var bs=class n{constructor(...e){this._delegate=new _s(...e)}static documentId(){return new n(Da.keyField().canonicalString())}isEqual(e){return e=W(e),e instanceof _s?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Ts=class n{static serverTimestamp(){let e=El();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=wl();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=Il(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=Sl(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=bl(e);return t._methodName="FieldValue.increment",new n(t)}constructor(e){this._delegate=e}isEqual(e){return this._delegate.isEqual(e._delegate)}};var Xh={Firestore:si,GeoPoint:Xa,Timestamp:ka,Blob:ii,Transaction:ri,WriteBatch:oi,DocumentReference:ve,DocumentSnapshot:Ke,Query:ze,QueryDocumentSnapshot:$e,QuerySnapshot:zt,CollectionReference:Et,FieldPath:bs,FieldValue:Ts,setLogLevel:Jh,CACHE_SIZE_UNLIMITED:Va};function Zh(n,e){n.INTERNAL.registerComponent(new Re("firestore-compat",t=>{let i=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(i,s)},"PUBLIC").setServiceProps(Object.assign({},Xh)))}function ed(n){Zh(n,(e,t)=>new si(e,t,new Is)),n.registerVersion(zh,Qh)}ed(ae);function nd(n,e=xn){return new Rn(t=>{let i;return e!=null?e.schedule(()=>{i=n.onSnapshot({includeMetadataChanges:!0},t)}):i=n.onSnapshot({includeMetadataChanges:!0},t),()=>{i?.()}})}function jl(n,e){return nd(n,e)}function id(n,e){return jl(n,e).pipe(ct(void 0),lt(),A(t=>{let[i,s]=t;return s.exists?i?.exists?{payload:s,type:"modified"}:{payload:s,type:"added"}:{payload:s,type:"removed"}}))}function Rs(n,e){return jl(n,e).pipe(A(t=>({payload:t,type:"query"})))}var ai=class{ref;afs;injector=de(ut);constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let i=this.ref.collection(e),{ref:s,query:r}=Kl(i,t);return new ci(s,r,this.afs)}snapshotChanges(){return id(this.ref,this.afs.schedulers.outsideAngular).pipe(F(this.injector))}valueChanges(e={}){return this.snapshotChanges().pipe(A(({payload:t})=>e.idField?ge(X({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return rt(this.ref.get(e)).pipe(F(this.injector))}};function li(n,e){return Rs(n,e).pipe(ct(void 0),lt(),A(t=>{let[i,s]=t,r=s.payload.docChanges(),o=r.map(a=>({type:a.type,payload:a}));return i&&JSON.stringify(i.payload.metadata)!==JSON.stringify(s.payload.metadata)&&s.payload.docs.forEach((a,l)=>{let c=r.find(u=>u.doc.ref.isEqual(a.ref)),h=i?.payload.docs.find(u=>u.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&h&&JSON.stringify(h.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function Vl(n,e,t){return li(n,t).pipe(je((i,s)=>sd(i,s.map(r=>r.payload),e),[]),at(),A(i=>i.map(s=>({type:s.type,payload:s}))))}function sd(n,e,t){return e.forEach(i=>{t.indexOf(i.type)>-1&&(n=rd(n,i))}),n}function Ns(n,e,t,...i){let s=n.slice();return s.splice(e,t,...i),s}function rd(n,e){switch(e.type){case"added":if(!n[e.newIndex]?.doc.ref.isEqual(e.doc.ref))return Ns(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return Ns(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]?.doc.ref.isEqual(e.doc.ref))return Ns(n,e.oldIndex,1);break}return n}function Gl(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var ci=class{ref;query;afs;injector=de(ut);constructor(e,t,i){this.ref=e,this.query=t,this.afs=i}stateChanges(e){let t=li(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(A(i=>i.filter(s=>e.indexOf(s.type)>-1)))),t.pipe(ct(void 0),lt(),ot(([i,s])=>s.length>0||!i),A(([,i])=>i),F(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(je((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=Gl(e);return Vl(this.query,t,this.afs.schedulers.outsideAngular).pipe(F(this.injector))}valueChanges(e={}){return Rs(this.query,this.afs.schedulers.outsideAngular).pipe(A(t=>t.payload.docs.map(i=>e.idField?ge(X({},i.data()),{[e.idField]:i.id}):i.data())),F(this.injector))}get(e){return rt(this.query.get(e)).pipe(F(this.injector))}add(e){return this.ref.add(e)}doc(e){return new ai(this.ref.doc(e),this.afs)}},Ps=class{query;afs;injector=de(ut);constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?li(this.query,this.afs.schedulers.outsideAngular).pipe(F(this.injector)):li(this.query,this.afs.schedulers.outsideAngular).pipe(A(t=>t.filter(i=>e.indexOf(i.type)>-1)),ot(t=>t.length>0),F(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(je((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=Gl(e);return Vl(this.query,t,this.afs.schedulers.outsideAngular).pipe(F(this.injector))}valueChanges(e={}){return Rs(this.query,this.afs.schedulers.outsideAngular).pipe(A(i=>i.payload.docs.map(s=>e.idField?X({[e.idField]:s.id},s.data()):s.data())),F(this.injector))}get(e){return rt(this.query.get(e)).pipe(F(this.injector))}},ql=new $("angularfire2.enableFirestorePersistence"),Hl=new $("angularfire2.firestore.persistenceSettings"),od=new $("angularfire2.firestore.settings"),ad=new $("angularfire2.firestore.use-emulator");function Kl(n,e=t=>t){return{query:e(n),ref:n}}var ld=(()=>{class n{schedulers;firestore;persistenceEnabled$;ngZone=de(j);constructor(t,i,s,r,o,a,l,c,h,u,d,p,g,v,T,J,_e){this.schedulers=l;let he=qn(t,a,i),Bt=h;u&&Jn(he,a,d,g,v,T,p,J),[this.firestore,this.persistenceEnabled$]=gt(`${he.name}.firestore`,"AngularFirestore",he.name,()=>{let jt=a.runOutsideAngular(()=>he.firestore());if(r&&jt.settings(r),Bt&&jt.useEmulator(...Bt),s&&!$o(o)){let bh=()=>{try{return rt(jt.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(Th){return typeof console<"u"&&console.warn(Th),Z(!1)}};return[jt,a.runOutsideAngular(bh)]}else return[jt,Z(!1)]},[r,Bt,s])}collection(t,i){let s;typeof t=="string"?s=this.firestore.collection(t):s=t;let{ref:r,query:o}=Kl(s,i),a=this.ngZone.run(()=>r);return new ci(a,o,this)}collectionGroup(t,i){let s=i||(o=>o),r=this.firestore.collectionGroup(t);return new Ps(s(r),this)}doc(t){let i;typeof t=="string"?i=this.firestore.doc(t):i=t;let s=this.ngZone.run(()=>i);return new ai(s,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(i){return new(i||n)(_(Vn),_(Gn,8),_(ql,8),_(od,8),_(Ge),_(j),_(_t),_(Hl,8),_(ad,8),_(mt,8),_(Hn,8),_(Kn,8),_($n,8),_(zn,8),_(Qn,8),_(Yn,8),_(jn,8))};static \u0275prov=me({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),$l=(()=>{class n{constructor(){ae.registerVersion("angularfire",xe.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:ql,useValue:!0},{provide:Hl,useValue:t}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=qe({type:n});static \u0275inj=Ve({providers:[ld]})}return n})();var zl="@firebase/database",Ql="1.0.14";var Vr="";function Gr(n){Vr=n}var Us=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),O(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Ln(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Ws=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return oe(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var Tc=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Us(e)}}catch{}return new Ws},Ye=Tc("localStorage"),Bs=Tc("sessionStorage");var Tt=new Bn("@firebase/database"),Ac=function(){let n=1;return function(){return n++}}(),Nc=function(n){let e=fa(n),t=new da;t.update(e);let i=t.digest();return ia.encodeByteArray(i)},vn=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=vn.apply(null,i):typeof i=="object"?e+=O(i):e+=i,e+=" "}return e},Je=null,Yl=!0,Pc=function(n,e){f(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Tt.logLevel=pa.VERBOSE,Je=Tt.log.bind(Tt),e&&Bs.set("logging_enabled",!0)):typeof n=="function"?Je=n:(Je=null,Bs.remove("logging_enabled"))},L=function(...n){if(Yl===!0&&(Yl=!1,Je===null&&Bs.get("logging_enabled")===!0&&Pc(!0)),Je){let e=vn.apply(null,n);Je(e)}},Cn=function(n){return function(...e){L(n,...e)}},js=function(...n){let e="FIREBASE INTERNAL ERROR: "+vn(...n);Tt.error(e)},Ee=function(...n){let e=`FIREBASE FATAL ERROR: ${vn(...n)}`;throw Tt.error(e),new Error(e)},B=function(...n){let e="FIREBASE WARNING: "+vn(...n);Tt.warn(e)},cd=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&B("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Li=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},ud=function(n){if(ye()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Me="[MIN_NAME]",Ae="[MAX_NAME]",Ze=function(n,e){if(n===e)return 0;if(n===Me||e===Ae)return-1;if(e===Me||n===Ae)return 1;{let t=Jl(n),i=Jl(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},hd=function(n,e){return n===e?0:n<e?-1:1},Qt=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+O(e))},qr=function(n){if(typeof n!="object"||n===null)return O(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=O(e[i]),t+=":",t+=qr(n[e[i]]);return t+="}",t},Rc=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function U(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var xc=function(n){f(!Li(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,s,r,o,a,l;n===0?(r=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-i-t))));let c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();let h=c.join(""),u="";for(l=0;l<64;l+=8){let d=parseInt(h.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),u=u+d}return u.toLowerCase()},dd=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},fd=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function pd(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var _d=new RegExp("^-?(0*)\\d{1,10}$"),gd=-2147483648,md=2147483647,Jl=function(n){if(_d.test(n)){let e=Number(n);if(e>=gd&&e<=md)return e}return null},Mt=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw B("Exception was thrown by user callback.",t),e},Math.floor(0))}},yd=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Zt=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Vs=class{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,ga(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){B(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Gs=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(L("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',B(e)}},en=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),hi="5",kc="v",Dc="s",Oc="r",Mc="f",Fc=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Lc="ls",Uc="p",qs="ac",Wc="websocket",Bc="long_polling";var di=class{constructor(e,t,i,s,r=!1,o="",a=!1,l=!1,c=null){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ye.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ye.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function vd(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function jc(n,e,t){f(typeof e=="string","typeof type must == string"),f(typeof t=="object","typeof params must == object");let i;if(e===Wc)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Bc)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);vd(n)&&(t.ns=n.namespace);let s=[];return U(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}var Hs=class{constructor(){this.counters_={}}incrementCounter(e,t=1){oe(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return ra(this.counters_)}};var xs={},ks={};function Hr(n){let e=n.toString();return xs[e]||(xs[e]=new Hs),xs[e]}function Cd(n,e){let t=n.toString();return ks[t]||(ks[t]=e()),ks[t]}var Ks=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&Mt(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var Xl="start",wd="close",Ed="pLPCommand",Id="pRTLPCB",Vc="id",Gc="pw",qc="ser",Sd="cb",bd="seg",Td="ts",Ad="d",Nd="dframe",Hc=1870,Kc=30,Pd=Hc-Kc,Rd=25e3,xd=3e4,rn=class n{constructor(e,t,i,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Cn(e),this.stats_=Hr(t),this.urlFn=l=>(this.appCheckToken&&(l[qs]=this.appCheckToken),jc(t,Bc,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ks(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(xd)),ud(()=>{if(this.isClosed_)return;this.scriptTagHolder=new $s((...r)=>{let[o,a,l,c,h]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Xl)this.id=a,this.password=l;else if(o===wd)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[Xl]="t",i[qc]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[Sd]=this.scriptTagHolder.uniqueCallbackIdentifier),i[kc]=hi,this.transportSessionId&&(i[Dc]=this.transportSessionId),this.lastSessionId&&(i[Lc]=this.lastSessionId),this.applicationId&&(i[Uc]=this.applicationId),this.appCheckToken&&(i[qs]=this.appCheckToken),typeof location<"u"&&location.hostname&&Fc.test(location.hostname)&&(i[Oc]=Mc);let s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return ye()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!dd()&&!fd()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=O(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=sa(t),s=Rc(i,Pd);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(ye())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[Nd]="t",i[Vc]=e,i[Gc]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=O(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},$s=class n{constructor(e,t,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,ye())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Ac(),window[Ed+this.uniqueCallbackIdentifier]=e,window[Id+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){L("frame writing exception"),a.stack&&L(a.stack),L(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||L("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[Vc]=this.myID,e[Gc]=this.myPW,e[qc]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Kc+i.length<=Hc;){let o=this.pendingSegs.shift();i=i+"&"+bd+s+"="+o.seg+"&"+Td+s+"="+o.ts+"&"+Ad+s+"="+o.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(Rd)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,t){ye()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{L("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var kd=16384,Dd=45e3,fi=null;typeof MozWebSocket<"u"?fi=MozWebSocket:typeof WebSocket<"u"&&(fi=WebSocket);var St=(()=>{class n{constructor(t,i,s,r,o,a,l){this.connId=t,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Cn(this.connId),this.stats_=Hr(i),this.connURL=n.connectionURL_(i,a,l,r,s),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,s,r,o){let a={};return a[kc]=hi,!ye()&&typeof location<"u"&&location.hostname&&Fc.test(location.hostname)&&(a[Oc]=Mc),i&&(a[Dc]=i),s&&(a[Lc]=s),r&&(a[qs]=r),o&&(a[Uc]=o),jc(t,Wc,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ye.set("previous_websocket_failure",!0);try{let s;if(ye()){let r=this.nodeAdmin?"AdminNode":"Node";s={headers:{"User-Agent":`Firebase/${hi}/${Vr}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new fi(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(i);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&fi!==null&&!n.forceDisallow_}static previouslyFailed(){return Ye.isInMemoryStorage||Ye.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ye.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let s=Ln(i);this.onMessage(s)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(f(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let s=this.extractFrameCount_(i);s!==null&&this.appendFrame_(s)}}send(t){this.resetKeepAlive();let i=O(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let s=Rc(i,kd);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Dd))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),$c=(()=>{class n{static get ALL_TRANSPORTS(){return[rn,St]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){let i=St&&St.isAvailable(),s=i&&!St.previouslyFailed();if(t.webSocketOnly&&(i||B("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[St];else{let r=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),Od=6e4,Md=5e3,Fd=10*1024,Ld=100*1024,Ds="t",Zl="d",Ud="s",ec="r",Wd="e",tc="o",nc="a",ic="n",sc="p",Bd="h",zs=class{constructor(e,t,i,s,r,o,a,l,c,h){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Cn("c:"+this.id+":"),this.transportManager_=new $c(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Zt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Ld?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Fd?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Ds in e){let t=e[Ds];t===nc?this.upgradeIfSecondaryHealthy_():t===ec?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===tc&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Qt("t",e),i=Qt("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:sc,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:nc,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:ic,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Qt("t",e),i=Qt("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Qt(Ds,e);if(Zl in e){let i=e[Zl];if(t===Bd){let s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===ic){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Ud?this.onConnectionShutdown_(i):t===ec?this.onReset_(i):t===Wd?js("Server Error: "+i):t===tc?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):js("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),hi!==i&&B("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),Zt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Od))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Zt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Md))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:sc,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ye.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var pi=class{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var _i=class{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);let s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){f(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var gi=class n extends _i{static getInstance(){return new n}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!us()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return f(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var rc=32,oc=768,b=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function S(){return new b("")}function C(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Fe(n){return n.pieces_.length-n.pieceNum_}function N(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new b(n.pieces_,e)}function Kr(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function jd(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function on(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function zc(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new b(e,0)}function R(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof b)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new b(t,0)}function w(n){return n.pieceNum_>=n.pieces_.length}function q(n,e){let t=C(n),i=C(e);if(t===null)return e;if(t===i)return q(N(n),N(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Vd(n,e){let t=on(n,0),i=on(e,0);for(let s=0;s<t.length&&s<i.length;s++){let r=Ze(t[s],i[s]);if(r!==0)return r}return t.length===i.length?0:t.length<i.length?-1:1}function $r(n,e){if(Fe(n)!==Fe(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function le(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(Fe(n)>Fe(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var Qs=class{constructor(e,t){this.errorPrefix_=t,this.parts_=on(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Ht(this.parts_[i]);Qc(this)}};function Gd(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ht(e),Qc(n)}function qd(n){let e=n.parts_.pop();n.byteLength_-=Ht(e),n.parts_.length>0&&(n.byteLength_-=1)}function Qc(n){if(n.byteLength_>oc)throw new Error(n.errorPrefix_+"has a key path longer than "+oc+" bytes ("+n.byteLength_+").");if(n.parts_.length>rc)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+rc+") or object contains a cycle "+Qe(n))}function Qe(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Ys=class n extends _i{static getInstance(){return new n}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return f(e==="visible","Unknown event type: "+e),[this.visible_]}};var Yt=1e3,Hd=60*5*1e3,ac=30*1e3,Kd=1.3,$d=3e4,zd="server_kill",lc=3,zr=(()=>{class n extends pi{constructor(t,i,s,r,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=Cn("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Yt,this.maxReconnectDelay_=Hd,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!ye())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ys.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&gi.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,s){let r=++this.requestNumber_,o={r,a:t,b:i};this.log_(O(o)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(t){this.initConnection_();let i=new V,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?i.resolve(l):i.reject(l)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,s,r){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:r,hashFn:i,query:t,tag:s};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(s)})}sendListen_(t){let i=t.query,s=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+s+" for "+r);let o={p:s},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,h=l.s;n.warnOnListenWarnings_(c,i),(this.listens.get(s)&&this.listens.get(s).get(r))===t&&(this.log_("listen response",l),h!=="ok"&&this.removeListen_(s,r),t.onComplete&&t.onComplete(h,c))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&oe(t,"w")){let s=Pe(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){let r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();B(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||ca(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=ac)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=la(t)?"auth":"gauth",s={cred:t};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(i,s,r=>{let o=r.s,a=r.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,s=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,s)})}unlisten(t,i){let s=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,t._queryObject,i)}sendUnlisten_(t,i,s,r){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";r&&(o.q=s,o.t=r),this.sendRequest(a,o)}onDisconnectPut(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:s})}onDisconnectMerge(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:s})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,s,r){let o={p:i,d:s};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,i,s,r){this.putInternal("p",t,i,s,r)}merge(t,i,s,r){this.putInternal("m",t,i,s,r)}putInternal(t,i,s,r,o){this.initConnection_();let a={p:i,d:s};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,s,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,s=>{if(s.s!=="ok"){let o=s.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+O(t));let i=t.r,s=this.requestCBHash_[i];s&&(delete this.requestCBHash_[i],s(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):js("Unrecognized action received from server: "+O(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Yt,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Yt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>$d&&(this.reconnectDelay_=Yt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Kd)}this.onConnectStatus_(!1)}establishConnection_(){return st(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,s())},h=function(d){f(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(d)};this.realtime_={close:c,sendRequest:h};let u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[d,p]=yield Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);a?L("getToken() completed but was canceled"):(L("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=p&&p.token,l=new zs(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,s,g=>{B(g+" ("+this.repoInfo_.toString()+")"),this.interrupt(zd)},o))}catch(d){this.log_("Failed to get token: "+d),a||(this.repoInfo_.nodeAdmin&&B(d),c())}}})}interrupt(t){L("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){L("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Un(this.interruptReasons_)&&(this.reconnectDelay_=Yt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let s;i?s=i.map(o=>qr(o)).join("$"):s="default";let r=this.removeListen_(t,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,i){let s=new b(t).toString(),r;if(this.listens.has(s)){let o=this.listens.get(s);r=o.get(i),o.delete(i),o.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(t,i){L("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=lc&&(this.reconnectDelay_=ac,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){L("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=lc&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";ye()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+Vr.replace(/\./g,"-")]=1,us()?t["framework.cordova"]=1:aa()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=gi.getInstance().currentlyOnline();return Un(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),E=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var At=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new E(Me,e),s=new E(Me,t);return this.compare(i,s)!==0}minPost(){return E.MIN}};var ui,mi=class extends At{static get __EMPTY_NODE(){return ui}static set __EMPTY_NODE(e){ui=e}compare(e,t){return Ze(e.name,t.name)}isDefinedOn(e){throw pt("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return E.MIN}maxPost(){return new E(Ae,ui)}makePost(e,t){return f(typeof e=="string","KeyIndex indexValue must always be a string."),new E(e,ui)}toString(){return".key"}},we=new mi;var bt=class{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},fe=(()=>{class n{constructor(t,i,s,r,o){this.key=t,this.value=i,this.color=s??n.RED,this.left=r??ce.EMPTY_NODE,this.right=o??ce.EMPTY_NODE}copy(t,i,s,r,o){return new n(t??this.key,i??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,s){let r=this,o=s(t,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(t,i,s),null):o===0?r=r.copy(null,i,null,null,null):r=r.copy(null,null,null,null,r.right.insert(t,i,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return ce.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let s,r;if(s=this,i(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),i(t,s.key)===0){if(s.right.isEmpty())return ce.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Js=class{copy(e,t,i,s,r){return this}insert(e,t,i){return new fe(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},ce=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,fe.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,fe.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new bt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new bt(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new bt(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new bt(this.root_,null,this.comparator_,!0,e)}};ce.EMPTY_NODE=new Js;function Qd(n,e){return Ze(n.name,e.name)}function Qr(n,e){return Ze(n,e)}var Xs;function Yd(n){Xs=n}var Yc=function(n){return typeof n=="number"?"number:"+xc(n):"string:"+n},Jc=function(n){if(n.isLeafNode()){let e=n.val();f(typeof e=="string"||typeof e=="number"||typeof e=="object"&&oe(e,".sv"),"Priority must be a string or number.")}else f(n===Xs||n.isEmpty(),"priority of unexpected type.");f(n===Xs||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var cc,Nt=(()=>{class n{static set __childrenNodeConstructor(t){cc=t}static get __childrenNodeConstructor(){return cc}constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,f(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Jc(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return w(t)?this:C(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let s=C(t);return s===null?i:i.isEmpty()&&s!==".priority"?this:(f(s!==".priority"||Fe(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(N(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Yc(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=xc(this.value_):t+=this.value_,this.lazyHash_=Nc(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(f(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,s=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(s);return f(r>=0,"Unknown leaf type: "+i),f(o>=0,"Unknown leaf type: "+s),r===o?s==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),Xc,Zc;function Jd(n){Xc=n}function Xd(n){Zc=n}var Zs=class extends At{compare(e,t){let i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return r===0?Ze(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return E.MIN}maxPost(){return new E(Ae,new Nt("[PRIORITY-POST]",Zc))}makePost(e,t){let i=Xc(e);return new E(t,new Nt("[PRIORITY-POST]",i))}toString(){return".priority"}},P=new Zs;var Zd=Math.log(2),er=class{constructor(e){let t=r=>parseInt(Math.log(r)/Zd,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},yi=function(n,e,t,i){n.sort(e);let s=function(l,c){let h=c-l,u,d;if(h===0)return null;if(h===1)return u=n[l],d=t?t(u):u,new fe(d,u.node,fe.BLACK,null,null);{let p=parseInt(h/2,10)+l,g=s(l,p),v=s(p+1,c);return u=n[p],d=t?t(u):u,new fe(d,u.node,fe.BLACK,g,v)}},r=function(l){let c=null,h=null,u=n.length,d=function(g,v){let T=u-g,J=u;u-=g;let _e=s(T+1,J),he=n[T],Bt=t?t(he):he;p(new fe(Bt,he.node,v,null,_e))},p=function(g){c?(c.left=g,c=g):(h=g,c=g)};for(let g=0;g<l.count;++g){let v=l.nextBitIsOne(),T=Math.pow(2,l.count-(g+1));v?d(T,fe.BLACK):(d(T,fe.BLACK),d(T,fe.RED))}return h},o=new er(n.length),a=r(o);return new ce(i||e,a)};var Os,It={},Pt=class n{static get Default(){return f(It&&P,"ChildrenNode.ts has not been loaded"),Os=Os||new n({".priority":It},{".priority":P}),Os}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=Pe(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ce?t:null}hasIndex(e){return oe(this.indexSet_,e.toString())}addIndex(e,t){f(e!==we,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],s=!1,r=t.getIterator(E.Wrap),o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=yi(i,e.getCompare()):a=It;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let h=Object.assign({},this.indexes_);return h[l]=a,new n(h,c)}addToIndexes(e,t){let i=qt(this.indexes_,(s,r)=>{let o=Pe(this.indexSet_,r);if(f(o,"Missing index implementation for "+r),s===It)if(o.isDefinedOn(e.node)){let a=[],l=t.getIterator(E.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),yi(a,o.getCompare())}else return It;else{let a=t.get(e.name),l=s;return a&&(l=l.remove(new E(e.name,a))),l.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=qt(this.indexes_,s=>{if(s===It)return s;{let r=t.get(e.name);return r?s.remove(new E(e.name,r)):s}});return new n(i,this.indexSet_)}};var Jt,y=(()=>{class n{static get EMPTY_NODE(){return Jt||(Jt=new n(new ce(Qr),null,Pt.Default))}constructor(t,i,s){this.children_=t,this.priorityNode_=i,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&Jc(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Jt}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?Jt:i}}getChild(t){let i=C(t);return i===null?this:this.getImmediateChild(i).getChild(N(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(f(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let s=new E(t,i),r,o;i.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(s,this.children_));let a=r.isEmpty()?Jt:this.priorityNode_;return new n(r,a,o)}}updateChild(t,i){let s=C(t);if(s===null)return i;{f(C(t)!==".priority"||Fe(t)===1,".priority must be the last token in a path");let r=this.getImmediateChild(s).updateChild(N(t),i);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},s=0,r=0,o=!0;if(this.forEachChild(P,(a,l)=>{i[a]=l.val(t),s++,o&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*s){let a=[];for(let l in i)a[l]=i[l];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+Yc(this.getPriority().val())+":"),this.forEachChild(P,(i,s)=>{let r=s.hash();r!==""&&(t+=":"+i+":"+r)}),this.lazyHash_=t===""?"":Nc(t)}return this.lazyHash_}getPredecessorChildName(t,i,s){let r=this.resolveIndex_(s);if(r){let o=r.getPredecessorKey(new E(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let s=i.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new E(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let s=i.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new E(i,this.children_.get(i)):null}forEachChild(t,i){let s=this.resolveIndex_(t);return s?s.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let s=this.resolveIndex_(i);if(s)return s.getIteratorFrom(t,r=>r);{let r=this.children_.getIteratorFrom(t.name,E.Wrap),o=r.peek();for(;o!=null&&i.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let s=this.resolveIndex_(i);if(s)return s.getReverseIteratorFrom(t,r=>r);{let r=this.children_.getReverseIteratorFrom(t.name,E.Wrap),o=r.peek();for(;o!=null&&i.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===wn?-1:0}withIndex(t){if(t===we||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===we||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let s=this.getIterator(P),r=i.getIterator(P),o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===we?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),tr=class extends y{constructor(){super(new ce(Qr),y.EMPTY_NODE,Pt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return y.EMPTY_NODE}isEmpty(){return!1}},wn=new tr;Object.defineProperties(E,{MIN:{value:new E(Me,y.EMPTY_NODE)},MAX:{value:new E(Ae,wn)}});mi.__EMPTY_NODE=y.EMPTY_NODE;Nt.__childrenNodeConstructor=y;Yd(wn);Xd(wn);var ef=!0;function x(n,e=null){if(n===null)return y.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),f(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Nt(t,x(e))}if(!(n instanceof Array)&&ef){let t=[],i=!1;if(U(n,(o,a)=>{if(o.substring(0,1)!=="."){let l=x(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),t.push(new E(o,l)))}}),t.length===0)return y.EMPTY_NODE;let r=yi(t,Qd,o=>o.name,Qr);if(i){let o=yi(t,P.getCompare());return new y(r,x(e),new Pt({".priority":o},{".priority":P}))}else return new y(r,x(e),Pt.Default)}else{let t=y.EMPTY_NODE;return U(n,(i,s)=>{if(oe(n,i)&&i.substring(0,1)!=="."){let r=x(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(x(e))}}Jd(x);var an=class extends At{constructor(e){super(),this.indexPath_=e,f(!w(e)&&C(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return r===0?Ze(e.name,t.name):r}makePost(e,t){let i=x(e),s=y.EMPTY_NODE.updateChild(this.indexPath_,i);return new E(t,s)}maxPost(){let e=y.EMPTY_NODE.updateChild(this.indexPath_,wn);return new E(Ae,e)}toString(){return on(this.indexPath_,0).join("/")}};var nr=class extends At{compare(e,t){let i=e.node.compareTo(t.node);return i===0?Ze(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return E.MIN}maxPost(){return E.MAX}makePost(e,t){let i=x(e);return new E(t,i)}toString(){return".value"}},Yr=new nr;function eu(n){return{type:"value",snapshotNode:n}}function Rt(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function ln(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function cn(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function tf(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var un=class{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(ln(t,a)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Rt(t,i)):o.trackChildChange(cn(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(P,(s,r)=>{t.hasChild(s)||i.trackChildChange(ln(s,r))}),t.isLeafNode()||t.forEachChild(P,(s,r)=>{if(e.hasChild(s)){let o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(cn(s,r,o))}else i.trackChildChange(Rt(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?y.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var vi=class n{constructor(e){this.indexedFilter_=new un(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,s,r,o){return this.matches(new E(t,i))||(i=y.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=y.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(y.EMPTY_NODE);let r=this;return t.forEachChild(P,(o,a)=>{r.matches(new E(o,a))||(s=s.updateImmediateChild(o,y.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var ir=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new vi(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new E(t,i))||(i=y.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=y.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=y.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(y.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,y.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){let u=this.index_.getCompare();o=(d,p)=>u(p,d)}else o=this.index_.getCompare();let a=e;f(a.numChildren()===this.limit_,"");let l=new E(t,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){let u=a.getImmediateChild(t),d=s.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=s.getChildAfterChild(this.index_,d,this.reverse_);let p=d==null?1:o(d,l);if(h&&!i.isEmpty()&&p>=0)return r?.trackChildChange(cn(t,i,u)),a.updateImmediateChild(t,i);{r?.trackChildChange(ln(t,u));let v=a.updateImmediateChild(t,y.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(r?.trackChildChange(Rt(d.name,d.node)),v.updateImmediateChild(d.name,d.node)):v}}else return i.isEmpty()?e:h&&o(c,l)>=0?(r!=null&&(r.trackChildChange(ln(c.name,c.node)),r.trackChildChange(Rt(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(c.name,y.EMPTY_NODE)):e}};var hn=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=P}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Me}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ae}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===P}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function nf(n){return n.loadsAllData()?new un(n.getIndex()):n.hasLimit()?new ir(n):new vi(n)}function sf(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function rf(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function sr(n,e,t){let i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function of(n,e,t){let i;return n.index_===we||t?i=sr(n,e,t):i=sr(n,e,Ae),i.startAfterSet_=!0,i}function rr(n,e,t){let i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function af(n,e,t){let i;return n.index_===we||t?i=rr(n,e,t):i=rr(n,e,Me),i.endBeforeSet_=!0,i}function Ui(n,e){let t=n.copy();return t.index_=e,t}function uc(n){let e={};if(n.isDefault())return e;let t;if(n.index_===P?t="$priority":n.index_===Yr?t="$value":n.index_===we?t="$key":(f(n.index_ instanceof an,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=O(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=O(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+O(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=O(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+O(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function hc(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==P&&(e.i=n.index_.toString()),e}var or=class n extends pi{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=Cn("p:rest:"),this.listens_={}}listen(e,t,i,s){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let l=uc(e._queryParams);this.restRequest_(r+".json",l,(c,h)=>{let u=h;if(c===404&&(u=null,c=null),c===null&&this.onDataUpdate_(r,u,!1,i),Pe(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",s(d,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=uc(e._queryParams),i=e._path.toString(),s=new V;return this.restRequest_(i+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ha(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Ln(a.responseText)}catch{B("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&B("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var ar=class{constructor(){this.rootNode_=y.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Ci(){return{value:null,children:new Map}}function Ft(n,e,t){if(w(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=C(e);n.children.has(i)||n.children.set(i,Ci());let s=n.children.get(i);e=N(e),Ft(s,e,t)}}function lr(n,e){if(w(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(P,(i,s)=>{Ft(n,new b(i),s)}),lr(n,e)}}else if(n.children.size>0){let t=C(e);return e=N(e),n.children.has(t)&&lr(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function cr(n,e,t){n.value!==null?t(e,n.value):lf(n,(i,s)=>{let r=new b(e.toString()+"/"+i);cr(s,r,t)})}function lf(n,e){n.children.forEach((t,i)=>{e(i,t)})}var ur=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&U(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}};var dc=10*1e3,cf=30*1e3,uf=5*60*1e3,hr=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new ur(e);let i=dc+(cf-dc)*Math.random();Zt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;U(e,(s,r)=>{r>0&&oe(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),Zt(this.reportStats_.bind(this),Math.floor(Math.random()*2*uf))}};var Ce=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Ce||{});function Jr(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Xr(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Zr(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var dr=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Ce.ACK_USER_WRITE,this.source=Jr()}operationForChild(e){if(w(this.path)){if(this.affectedTree.value!=null)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new b(e));return new n(S(),t,this.revert)}}else return f(C(this.path)===e,"operationForChild called for unrelated child."),new n(N(this.path),this.affectedTree,this.revert)}};var wi=class n{constructor(e,t){this.source=e,this.path=t,this.type=Ce.LISTEN_COMPLETE}operationForChild(e){return w(this.path)?new n(this.source,S()):new n(this.source,N(this.path))}};var xt=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Ce.OVERWRITE}operationForChild(e){return w(this.path)?new n(this.source,S(),this.snap.getImmediateChild(e)):new n(this.source,N(this.path),this.snap)}};var dn=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Ce.MERGE}operationForChild(e){if(w(this.path)){let t=this.children.subtree(new b(e));return t.isEmpty()?null:t.value?new xt(this.source,S(),t.value):new n(this.source,S(),t)}else return f(C(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,N(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Ie=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(w(e))return this.isFullyInitialized()&&!this.filtered_;let t=C(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var fr=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function hf(n,e,t,i){let s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(tf(o.childName,o.snapshotNode))}),Xt(n,s,"child_removed",e,i,t),Xt(n,s,"child_added",e,i,t),Xt(n,s,"child_moved",r,i,t),Xt(n,s,"child_changed",e,i,t),Xt(n,s,"value",e,i,t),s}function Xt(n,e,t,i,s,r){let o=i.filter(a=>a.type===t);o.sort((a,l)=>ff(n,a,l)),o.forEach(a=>{let l=df(n,a,r);s.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function df(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function ff(n,e,t){if(e.childName==null||t.childName==null)throw pt("Should only compare child_ events.");let i=new E(e.childName,e.snapshotNode),s=new E(t.childName,t.snapshotNode);return n.index_.compare(i,s)}function Wi(n,e){return{eventCache:n,serverCache:e}}function tn(n,e,t,i){return Wi(new Ie(e,t,i),n.serverCache)}function tu(n,e,t,i){return Wi(n.eventCache,new Ie(e,t,i))}function Ei(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Xe(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Ms,pf=()=>(Ms||(Ms=new ce(hd)),Ms),H=class n{static fromObject(e){let t=new n(null);return U(e,(i,s)=>{t=t.set(new b(i),s)}),t}constructor(e,t=pf()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:S(),value:this.value};if(w(e))return null;{let i=C(e),s=this.children.get(i);if(s!==null){let r=s.findRootMostMatchingPathAndValue(N(e),t);return r!=null?{path:R(new b(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(w(e))return this;{let t=C(e),i=this.children.get(t);return i!==null?i.subtree(N(e)):new n(null)}}set(e,t){if(w(e))return new n(t,this.children);{let i=C(e),r=(this.children.get(i)||new n(null)).set(N(e),t),o=this.children.insert(i,r);return new n(this.value,o)}}remove(e){if(w(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=C(e),i=this.children.get(t);if(i){let s=i.remove(N(e)),r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new n(null):new n(this.value,r)}else return this}}get(e){if(w(e))return this.value;{let t=C(e),i=this.children.get(t);return i?i.get(N(e)):null}}setTree(e,t){if(w(e))return t;{let i=C(e),r=(this.children.get(i)||new n(null)).setTree(N(e),t),o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new n(this.value,o)}}fold(e){return this.fold_(S(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(R(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,S(),t)}findOnPath_(e,t,i){let s=this.value?i(t,this.value):!1;if(s)return s;if(w(e))return null;{let r=C(e),o=this.children.get(r);return o?o.findOnPath_(N(e),R(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,S(),t)}foreachOnPath_(e,t,i){if(w(e))return this;{this.value&&i(t,this.value);let s=C(e),r=this.children.get(s);return r?r.foreachOnPath_(N(e),R(t,s),i):new n(null)}}foreach(e){this.foreach_(S(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(R(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var pe=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new H(null))}};function nn(n,e,t){if(w(e))return new pe(new H(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let s=i.path,r=i.value,o=q(s,e);return r=r.updateChild(o,t),new pe(n.writeTree_.set(s,r))}else{let s=new H(t),r=n.writeTree_.setTree(e,s);return new pe(r)}}}function pr(n,e,t){let i=n;return U(t,(s,r)=>{i=nn(i,R(e,s),r)}),i}function fc(n,e){if(w(e))return pe.empty();{let t=n.writeTree_.setTree(e,new H(null));return new pe(t)}}function _r(n,e){return et(n,e)!=null}function et(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(q(t.path,e)):null}function pc(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(P,(i,s)=>{e.push(new E(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new E(i,s.value))}),e}function De(n,e){if(w(e))return n;{let t=et(n,e);return t!=null?new pe(new H(t)):new pe(n.writeTree_.subtree(e))}}function gr(n){return n.writeTree_.isEmpty()}function kt(n,e){return nu(S(),n.writeTree_,e)}function nu(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(f(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):t=nu(R(n,s),r,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(R(n,".priority"),i)),t}}function Bi(n,e){return ou(e,n)}function _f(n,e,t,i,s){f(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=nn(n.visibleWrites,e,t)),n.lastWriteId=i}function gf(n,e,t,i){f(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=pr(n.visibleWrites,e,t),n.lastWriteId=i}function mf(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function yf(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);f(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&vf(a,i.path)?s=!1:le(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return Cf(n),!0;if(i.snap)n.visibleWrites=fc(n.visibleWrites,i.path);else{let a=i.children;U(a,l=>{n.visibleWrites=fc(n.visibleWrites,R(i.path,l))})}return!0}else return!1}function vf(n,e){if(n.snap)return le(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&le(R(n.path,t),e))return!0;return!1}function Cf(n){n.visibleWrites=iu(n.allWrites,wf,S()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function wf(n){return n.visible}function iu(n,e,t){let i=pe.empty();for(let s=0;s<n.length;++s){let r=n[s];if(e(r)){let o=r.path,a;if(r.snap)le(t,o)?(a=q(t,o),i=nn(i,a,r.snap)):le(o,t)&&(a=q(o,t),i=nn(i,S(),r.snap.getChild(a)));else if(r.children){if(le(t,o))a=q(t,o),i=pr(i,a,r.children);else if(le(o,t))if(a=q(o,t),w(a))i=pr(i,S(),r.children);else{let l=Pe(r.children,C(a));if(l){let c=l.getChild(N(a));i=nn(i,S(),c)}}}else throw pt("WriteRecord should have .snap or .children")}}return i}function su(n,e,t,i,s){if(!i&&!s){let r=et(n.visibleWrites,e);if(r!=null)return r;{let o=De(n.visibleWrites,e);if(gr(o))return t;if(t==null&&!_r(o,S()))return null;{let a=t||y.EMPTY_NODE;return kt(o,a)}}}else{let r=De(n.visibleWrites,e);if(!s&&gr(r))return t;if(!s&&t==null&&!_r(r,S()))return null;{let o=function(c){return(c.visible||s)&&(!i||!~i.indexOf(c.writeId))&&(le(c.path,e)||le(e,c.path))},a=iu(n.allWrites,o,e),l=t||y.EMPTY_NODE;return kt(a,l)}}}function Ef(n,e,t){let i=y.EMPTY_NODE,s=et(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(P,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){let r=De(n.visibleWrites,e);return t.forEachChild(P,(o,a)=>{let l=kt(De(r,new b(o)),a);i=i.updateImmediateChild(o,l)}),pc(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let r=De(n.visibleWrites,e);return pc(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function If(n,e,t,i,s){f(i||s,"Either existingEventSnap or existingServerSnap must exist");let r=R(e,t);if(_r(n.visibleWrites,r))return null;{let o=De(n.visibleWrites,r);return gr(o)?s.getChild(t):kt(o,s.getChild(t))}}function Sf(n,e,t,i){let s=R(e,t),r=et(n.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(t)){let o=De(n.visibleWrites,s);return kt(o,i.getNode().getImmediateChild(t))}else return null}function bf(n,e){return et(n.visibleWrites,e)}function Tf(n,e,t,i,s,r,o){let a,l=De(n.visibleWrites,e),c=et(l,S());if(c!=null)a=c;else if(t!=null)a=kt(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let h=[],u=o.getCompare(),d=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),p=d.getNext();for(;p&&h.length<s;)u(p,i)!==0&&h.push(p),p=d.getNext();return h}else return[]}function Af(){return{visibleWrites:pe.empty(),allWrites:[],lastWriteId:-1}}function Ii(n,e,t,i){return su(n.writeTree,n.treePath,e,t,i)}function eo(n,e){return Ef(n.writeTree,n.treePath,e)}function _c(n,e,t,i){return If(n.writeTree,n.treePath,e,t,i)}function Si(n,e){return bf(n.writeTree,R(n.treePath,e))}function Nf(n,e,t,i,s,r){return Tf(n.writeTree,n.treePath,e,t,i,s,r)}function to(n,e,t){return Sf(n.writeTree,n.treePath,e,t)}function ru(n,e){return ou(R(n.treePath,e),n.writeTree)}function ou(n,e){return{treePath:n,writeTree:e}}var mr=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;f(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),f(i!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(i);if(s){let r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(i,cn(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(i,ln(i,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(i,Rt(i,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(i,cn(i,e.snapshotNode,s.oldSnap));else throw pt("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var yr=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},au=new yr,fn=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new Ie(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return to(this.writes_,e,i)}}getChildAfterChild(e,t,i){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Xe(this.viewCache_),r=Nf(this.writes_,s,t,1,i,e);return r.length===0?null:r[0]}};function Pf(n){return{filter:n}}function Rf(n,e){f(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function xf(n,e,t,i,s){let r=new mr,o,a;if(t.type===Ce.OVERWRITE){let c=t;c.source.fromUser?o=vr(n,e,c.path,c.snap,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!w(c.path),o=bi(n,e,c.path,c.snap,i,s,a,r))}else if(t.type===Ce.MERGE){let c=t;c.source.fromUser?o=Df(n,e,c.path,c.children,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=Cr(n,e,c.path,c.children,i,s,a,r))}else if(t.type===Ce.ACK_USER_WRITE){let c=t;c.revert?o=Ff(n,e,c.path,i,s,r):o=Of(n,e,c.path,c.affectedTree,i,s,r)}else if(t.type===Ce.LISTEN_COMPLETE)o=Mf(n,e,t.path,i,r);else throw pt("Unknown operation type: "+t.type);let l=r.getChanges();return kf(e,o,l),{viewCache:o,changes:l}}function kf(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Ei(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(eu(Ei(e)))}}function lu(n,e,t,i,s,r){let o=e.eventCache;if(Si(i,t)!=null)return e;{let a,l;if(w(t))if(f(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=Xe(e),h=c instanceof y?c:y.EMPTY_NODE,u=eo(i,h);a=n.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{let c=Ii(i,Xe(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{let c=C(t);if(c===".priority"){f(Fe(t)===1,"Can't have a priority with additional path components");let h=o.getNode();l=e.serverCache.getNode();let u=_c(i,t,h,l);u!=null?a=n.filter.updatePriority(h,u):a=o.getNode()}else{let h=N(t),u;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let d=_c(i,t,o.getNode(),l);d!=null?u=o.getNode().getImmediateChild(c).updateChild(h,d):u=o.getNode().getImmediateChild(c)}else u=to(i,c,e.serverCache);u!=null?a=n.filter.updateChild(o.getNode(),c,u,h,s,r):a=o.getNode()}}return tn(e,a,o.isFullyInitialized()||w(t),n.filter.filtersNodes())}}function bi(n,e,t,i,s,r,o,a){let l=e.serverCache,c,h=o?n.filter:n.filter.getIndexedFilter();if(w(t))c=h.updateFullNode(l.getNode(),i,null);else if(h.filtersNodes()&&!l.isFiltered()){let p=l.getNode().updateChild(t,i);c=h.updateFullNode(l.getNode(),p,null)}else{let p=C(t);if(!l.isCompleteForPath(t)&&Fe(t)>1)return e;let g=N(t),T=l.getNode().getImmediateChild(p).updateChild(g,i);p===".priority"?c=h.updatePriority(l.getNode(),T):c=h.updateChild(l.getNode(),p,T,g,au,null)}let u=tu(e,c,l.isFullyInitialized()||w(t),h.filtersNodes()),d=new fn(s,u,r);return lu(n,u,t,s,d,a)}function vr(n,e,t,i,s,r,o){let a=e.eventCache,l,c,h=new fn(s,e,r);if(w(t))c=n.filter.updateFullNode(e.eventCache.getNode(),i,o),l=tn(e,c,!0,n.filter.filtersNodes());else{let u=C(t);if(u===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),i),l=tn(e,c,a.isFullyInitialized(),a.isFiltered());else{let d=N(t),p=a.getNode().getImmediateChild(u),g;if(w(d))g=i;else{let v=h.getCompleteChild(u);v!=null?Kr(d)===".priority"&&v.getChild(zc(d)).isEmpty()?g=v:g=v.updateChild(d,i):g=y.EMPTY_NODE}if(p.equals(g))l=e;else{let v=n.filter.updateChild(a.getNode(),u,g,d,h,o);l=tn(e,v,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function gc(n,e){return n.eventCache.isCompleteForChild(e)}function Df(n,e,t,i,s,r,o){let a=e;return i.foreach((l,c)=>{let h=R(t,l);gc(e,C(h))&&(a=vr(n,a,h,c,s,r,o))}),i.foreach((l,c)=>{let h=R(t,l);gc(e,C(h))||(a=vr(n,a,h,c,s,r,o))}),a}function mc(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function Cr(n,e,t,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;w(t)?c=i:c=new H(null).setTree(t,i);let h=e.serverCache.getNode();return c.children.inorderTraversal((u,d)=>{if(h.hasChild(u)){let p=e.serverCache.getNode().getImmediateChild(u),g=mc(n,p,d);l=bi(n,l,new b(u),g,s,r,o,a)}}),c.children.inorderTraversal((u,d)=>{let p=!e.serverCache.isCompleteForChild(u)&&d.value===null;if(!h.hasChild(u)&&!p){let g=e.serverCache.getNode().getImmediateChild(u),v=mc(n,g,d);l=bi(n,l,new b(u),v,s,r,o,a)}}),l}function Of(n,e,t,i,s,r,o){if(Si(s,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if(w(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return bi(n,e,t,l.getNode().getChild(t),s,r,a,o);if(w(t)){let c=new H(null);return l.getNode().forEachChild(we,(h,u)=>{c=c.set(new b(h),u)}),Cr(n,e,t,c,s,r,a,o)}else return e}else{let c=new H(null);return i.foreach((h,u)=>{let d=R(t,h);l.isCompleteForPath(d)&&(c=c.set(h,l.getNode().getChild(d)))}),Cr(n,e,t,c,s,r,a,o)}}function Mf(n,e,t,i,s){let r=e.serverCache,o=tu(e,r.getNode(),r.isFullyInitialized()||w(t),r.isFiltered());return lu(n,o,t,i,au,s)}function Ff(n,e,t,i,s,r){let o;if(Si(i,t)!=null)return e;{let a=new fn(i,e,s),l=e.eventCache.getNode(),c;if(w(t)||C(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=Ii(i,Xe(e));else{let u=e.serverCache.getNode();f(u instanceof y,"serverChildren would be complete if leaf node"),h=eo(i,u)}h=h,c=n.filter.updateFullNode(l,h,r)}else{let h=C(t),u=to(i,h,e.serverCache);u==null&&e.serverCache.isCompleteForChild(h)&&(u=l.getImmediateChild(h)),u!=null?c=n.filter.updateChild(l,h,u,N(t),a,r):e.eventCache.getNode().hasChild(h)?c=n.filter.updateChild(l,h,y.EMPTY_NODE,N(t),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Ii(i,Xe(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||Si(i,S())!=null,tn(e,c,o,n.filter.filtersNodes())}}var wr=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,s=new un(i.getIndex()),r=nf(i);this.processor_=Pf(r);let o=t.serverCache,a=t.eventCache,l=s.updateFullNode(y.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(y.EMPTY_NODE,a.getNode(),null),h=new Ie(l,o.isFullyInitialized(),s.filtersNodes()),u=new Ie(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Wi(u,h),this.eventGenerator_=new fr(this.query_)}get query(){return this.query_}};function Lf(n){return n.viewCache_.serverCache.getNode()}function Uf(n){return Ei(n.viewCache_)}function Wf(n,e){let t=Xe(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!w(e)&&!t.getImmediateChild(C(e)).isEmpty())?t.getChild(e):null}function yc(n){return n.eventRegistrations_.length===0}function Bf(n,e){n.eventRegistrations_.push(e)}function vc(n,e,t){let i=[];if(t){f(e==null,"A cancel should cancel all event registrations.");let s=n.query._path;n.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){let o=n.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function Cc(n,e,t,i){e.type===Ce.MERGE&&e.source.queryId!==null&&(f(Xe(n.viewCache_),"We should always have a full cache before handling merges"),f(Ei(n.viewCache_),"Missing event cache, even though we have a server cache"));let s=n.viewCache_,r=xf(n.processor_,s,e,t,i);return Rf(n.processor_,r.viewCache),f(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,cu(n,r.changes,r.viewCache.eventCache.getNode(),null)}function jf(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(P,(r,o)=>{i.push(Rt(r,o))}),t.isFullyInitialized()&&i.push(eu(t.getNode())),cu(n,i,t.getNode(),e)}function cu(n,e,t,i){let s=i?[i]:n.eventRegistrations_;return hf(n.eventGenerator_,e,t,s)}var Ti,Ai=class{constructor(){this.views=new Map}};function Vf(n){f(!Ti,"__referenceConstructor has already been defined"),Ti=n}function Gf(){return f(Ti,"Reference.ts has not been loaded"),Ti}function qf(n){return n.views.size===0}function no(n,e,t,i){let s=e.source.queryId;if(s!==null){let r=n.views.get(s);return f(r!=null,"SyncTree gave us an op for an invalid query."),Cc(r,e,t,i)}else{let r=[];for(let o of n.views.values())r=r.concat(Cc(o,e,t,i));return r}}function uu(n,e,t,i,s){let r=e._queryIdentifier,o=n.views.get(r);if(!o){let a=Ii(t,s?i:null),l=!1;a?l=!0:i instanceof y?(a=eo(t,i),l=!1):(a=y.EMPTY_NODE,l=!1);let c=Wi(new Ie(a,l,!1),new Ie(i,s,!1));return new wr(e,c)}return o}function Hf(n,e,t,i,s,r){let o=uu(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),Bf(o,t),jf(o,t)}function Kf(n,e,t,i){let s=e._queryIdentifier,r=[],o=[],a=Le(n);if(s==="default")for(let[l,c]of n.views.entries())o=o.concat(vc(c,t,i)),yc(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{let l=n.views.get(s);l&&(o=o.concat(vc(l,t,i)),yc(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!Le(n)&&r.push(new(Gf())(e._repo,e._path)),{removed:r,events:o}}function hu(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Oe(n,e){let t=null;for(let i of n.views.values())t=t||Wf(i,e);return t}function du(n,e){if(e._queryParams.loadsAllData())return ji(n);{let i=e._queryIdentifier;return n.views.get(i)}}function fu(n,e){return du(n,e)!=null}function Le(n){return ji(n)!=null}function ji(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Ni;function $f(n){f(!Ni,"__referenceConstructor has already been defined"),Ni=n}function zf(){return f(Ni,"Reference.ts has not been loaded"),Ni}var Qf=1,Pi=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new H(null),this.pendingWriteTree_=Af(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function io(n,e,t,i,s){return _f(n.pendingWriteTree_,e,t,i,s),s?Lt(n,new xt(Jr(),e,t)):[]}function Yf(n,e,t,i){gf(n.pendingWriteTree_,e,t,i);let s=H.fromObject(t);return Lt(n,new dn(Jr(),e,s))}function ke(n,e,t=!1){let i=mf(n.pendingWriteTree_,e);if(yf(n.pendingWriteTree_,e)){let r=new H(null);return i.snap!=null?r=r.set(S(),!0):U(i.children,o=>{r=r.set(new b(o),!0)}),Lt(n,new dr(i.path,r,t))}else return[]}function En(n,e,t){return Lt(n,new xt(Xr(),e,t))}function Jf(n,e,t){let i=H.fromObject(t);return Lt(n,new dn(Xr(),e,i))}function Xf(n,e){return Lt(n,new wi(Xr(),e))}function Zf(n,e,t){let i=so(n,t);if(i){let s=ro(i),r=s.path,o=s.queryId,a=q(r,e),l=new wi(Zr(o),a);return oo(n,r,l)}else return[]}function Ri(n,e,t,i,s=!1){let r=e._path,o=n.syncPointTree_.get(r),a=[];if(o&&(e._queryIdentifier==="default"||fu(o,e))){let l=Kf(o,e,t,i);qf(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));let c=l.removed;if(a=l.events,!s){let h=c.findIndex(d=>d._queryParams.loadsAllData())!==-1,u=n.syncPointTree_.findOnPath(r,(d,p)=>Le(p));if(h&&!u){let d=n.syncPointTree_.subtree(r);if(!d.isEmpty()){let p=np(d);for(let g=0;g<p.length;++g){let v=p[g],T=v.query,J=mu(n,v);n.listenProvider_.startListening(sn(T),pn(n,T),J.hashFn,J.onComplete)}}}!u&&c.length>0&&!i&&(h?n.listenProvider_.stopListening(sn(e),null):c.forEach(d=>{let p=n.queryToTagMap.get(Gi(d));n.listenProvider_.stopListening(sn(d),p)}))}ip(n,c)}return a}function pu(n,e,t,i){let s=so(n,i);if(s!=null){let r=ro(s),o=r.path,a=r.queryId,l=q(o,e),c=new xt(Zr(a),l,t);return oo(n,o,c)}else return[]}function ep(n,e,t,i){let s=so(n,i);if(s){let r=ro(s),o=r.path,a=r.queryId,l=q(o,e),c=H.fromObject(t),h=new dn(Zr(a),l,c);return oo(n,o,h)}else return[]}function Er(n,e,t,i=!1){let s=e._path,r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(d,p)=>{let g=q(d,s);r=r||Oe(p,g),o=o||Le(p)});let a=n.syncPointTree_.get(s);a?(o=o||Le(a),r=r||Oe(a,S())):(a=new Ai,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;r!=null?l=!0:(l=!1,r=y.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((p,g)=>{let v=Oe(g,S());v&&(r=r.updateImmediateChild(p,v))}));let c=fu(a,e);if(!c&&!e._queryParams.loadsAllData()){let d=Gi(e);f(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");let p=sp();n.queryToTagMap.set(d,p),n.tagToQueryMap.set(p,d)}let h=Bi(n.pendingWriteTree_,s),u=Hf(a,e,t,h,r,l);if(!c&&!o&&!i){let d=du(a,e);u=u.concat(rp(n,e,d))}return u}function Vi(n,e,t){let s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{let l=q(o,e),c=Oe(a,l);if(c)return c});return su(s,e,r,t,!0)}function tp(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(c,h)=>{let u=q(c,t);i=i||Oe(h,u)});let s=n.syncPointTree_.get(t);s?i=i||Oe(s,S()):(s=new Ai,n.syncPointTree_=n.syncPointTree_.set(t,s));let r=i!=null,o=r?new Ie(i,!0,!1):null,a=Bi(n.pendingWriteTree_,e._path),l=uu(s,e,a,r?o.getNode():y.EMPTY_NODE,r);return Uf(l)}function Lt(n,e){return _u(e,n.syncPointTree_,null,Bi(n.pendingWriteTree_,S()))}function _u(n,e,t,i){if(w(n.path))return gu(n,e,t,i);{let s=e.get(S());t==null&&s!=null&&(t=Oe(s,S()));let r=[],o=C(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){let c=t?t.getImmediateChild(o):null,h=ru(i,o);r=r.concat(_u(a,l,c,h))}return s&&(r=r.concat(no(s,n,i,t))),r}}function gu(n,e,t,i){let s=e.get(S());t==null&&s!=null&&(t=Oe(s,S()));let r=[];return e.children.inorderTraversal((o,a)=>{let l=t?t.getImmediateChild(o):null,c=ru(i,o),h=n.operationForChild(o);h&&(r=r.concat(gu(h,a,l,c)))}),s&&(r=r.concat(no(s,n,i,t))),r}function mu(n,e){let t=e.query,i=pn(n,t);return{hashFn:()=>(Lf(e)||y.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?Zf(n,t._path,i):Xf(n,t._path);{let r=pd(s,t);return Ri(n,t,null,r)}}}}function pn(n,e){let t=Gi(e);return n.queryToTagMap.get(t)}function Gi(n){return n._path.toString()+"$"+n._queryIdentifier}function so(n,e){return n.tagToQueryMap.get(e)}function ro(n){let e=n.indexOf("$");return f(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new b(n.substr(0,e))}}function oo(n,e,t){let i=n.syncPointTree_.get(e);f(i,"Missing sync point for query tag that we're tracking");let s=Bi(n.pendingWriteTree_,e);return no(i,t,s,null)}function np(n){return n.fold((e,t,i)=>{if(t&&Le(t))return[ji(t)];{let s=[];return t&&(s=hu(t)),U(i,(r,o)=>{s=s.concat(o)}),s}})}function sn(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(zf())(n._repo,n._path):n}function ip(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let s=Gi(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}function sp(){return Qf++}function rp(n,e,t){let i=e._path,s=pn(n,e),r=mu(n,t),o=n.listenProvider_.startListening(sn(e),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)f(!Le(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,h,u)=>{if(!w(c)&&h&&Le(h))return[ji(h).query];{let d=[];return h&&(d=d.concat(hu(h).map(p=>p.query))),U(u,(p,g)=>{d=d.concat(g)}),d}});for(let c=0;c<l.length;++c){let h=l[c];n.listenProvider_.stopListening(sn(h),pn(n,h))}}return o}var Ir=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Sr=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=R(this.path_,e);return new n(this.syncTree_,t)}node(){return Vi(this.syncTree_,this.path_)}},op=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},wc=function(n,e,t){if(!n||typeof n!="object")return n;if(f(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return ap(n[".sv"],e,t);if(typeof n[".sv"]=="object")return lp(n[".sv"],e);f(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},ap=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:f(!1,"Unexpected server value: "+n)}},lp=function(n,e,t){n.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&f(!1,"Unexpected increment value: "+i);let s=e.node();if(f(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;let o=s.getValue();return typeof o!="number"?i:o+i},yu=function(n,e,t,i){return lo(e,new Sr(t,n),i)},ao=function(n,e,t){return lo(n,new Ir(e),t)};function lo(n,e,t){let i=n.getPriority().val(),s=wc(i,e.getImmediateChild(".priority"),t),r;if(n.isLeafNode()){let o=n,a=wc(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Nt(a,x(s)):n}else{let o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Nt(s))),o.forEachChild(P,(a,l)=>{let c=lo(l,e.getImmediateChild(a),t);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}var _n=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function qi(n,e){let t=e instanceof b?e:new b(e),i=n,s=C(t);for(;s!==null;){let r=Pe(i.node.children,s)||{children:{},childCount:0};i=new _n(s,i,r),t=N(t),s=C(t)}return i}function tt(n){return n.node.value}function co(n,e){n.node.value=e,br(n)}function vu(n){return n.node.childCount>0}function cp(n){return tt(n)===void 0&&!vu(n)}function Hi(n,e){U(n.node.children,(t,i)=>{e(new _n(t,n,i))})}function Cu(n,e,t,i){t&&!i&&e(n),Hi(n,s=>{Cu(s,e,!0,i)}),t&&i&&e(n)}function up(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function In(n){return new b(n.parent===null?n.name:In(n.parent)+"/"+n.name)}function br(n){n.parent!==null&&hp(n.parent,n.name,n)}function hp(n,e,t){let i=cp(t),s=oe(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,br(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,br(n))}var dp=/[\[\].#$\/\u0000-\u001F\u007F]/,fp=/[\[\].#$\u0000-\u001F\u007F]/,Fs=10*1024*1024,Ki=function(n){return typeof n=="string"&&n.length!==0&&!dp.test(n)},wu=function(n){return typeof n=="string"&&n.length!==0&&!fp.test(n)},pp=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),wu(n)},gn=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Li(n)||n&&typeof n=="object"&&oe(n,".sv")},Se=function(n,e,t,i){i&&e===void 0||Sn(Y(n,"value"),e,t)},Sn=function(n,e,t){let i=t instanceof b?new Qs(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Qe(i));if(typeof e=="function")throw new Error(n+"contains a function "+Qe(i)+" with contents = "+e.toString());if(Li(e))throw new Error(n+"contains "+e.toString()+" "+Qe(i));if(typeof e=="string"&&e.length>Fs/3&&Ht(e)>Fs)throw new Error(n+"contains a string greater than "+Fs+" utf8 bytes "+Qe(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(U(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Ki(o)))throw new Error(n+" contains an invalid key ("+o+") "+Qe(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Gd(i,o),Sn(n,a,i),qd(i)}),s&&r)throw new Error(n+' contains ".value" child '+Qe(i)+" in addition to actual children.")}},_p=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];let r=on(i);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!Ki(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Vd);let s=null;for(t=0;t<e.length;t++){if(i=e[t],s!==null&&le(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}},Eu=function(n,e,t,i){if(i&&e===void 0)return;let s=Y(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");let r=[];U(e,(o,a)=>{let l=new b(o);if(Sn(s,a,R(t,l)),Kr(l)===".priority"&&!gn(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),_p(s,r)},uo=function(n,e,t){if(!(t&&e===void 0)){if(Li(e))throw new Error(Y(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!gn(e))throw new Error(Y(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},bn=function(n,e,t,i){if(!(i&&t===void 0)&&!Ki(t))throw new Error(Y(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Ut=function(n,e,t,i){if(!(i&&t===void 0)&&!wu(t))throw new Error(Y(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},gp=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Ut(n,e,t,i)},ne=function(n,e){if(C(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Iu=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Ki(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!pp(t))throw new Error(Y(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Tr=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function $i(n,e){let t=null;for(let i=0;i<e.length;i++){let s=e[i],r=s.getPath();t!==null&&!$r(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function Su(n,e,t){$i(n,t),bu(n,i=>$r(i,e))}function ie(n,e,t){$i(n,t),bu(n,i=>le(i,e)||le(e,i))}function bu(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let s=n.eventLists_[i];if(s){let r=s.path;e(r)?(mp(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function mp(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();Je&&L("event: "+t.toString()),Mt(i)}}}var Tu="repo_interrupt",yp=25,Ar=class{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Tr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ci(),this.transactionQueueTree_=new _n,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function vp(n,e,t){if(n.stats_=Hr(n.repoInfo_),n.forceRestClient_||yd())n.server_=new or(n.repoInfo_,(i,s,r,o)=>{Ec(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Ic(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{O(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new zr(n.repoInfo_,e,(i,s,r,o)=>{Ec(n,i,s,r,o)},i=>{Ic(n,i)},i=>{Cp(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=Cd(n.repoInfo_,()=>new hr(n.stats_,n.server_)),n.infoData_=new ar,n.infoSyncTree_=new Pi({startListening:(i,s,r,o)=>{let a=[],l=n.infoData_.getNode(i._path);return l.isEmpty()||(a=En(n.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),ho(n,"connected",!1),n.serverSyncTree_=new Pi({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,l)=>{let c=o(a,l);ie(n.eventQueue_,i._path,c)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function Au(n){let t=n.infoData_.getNode(new b(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Tn(n){return op({timestamp:Au(n)})}function Ec(n,e,t,i,s){n.dataUpdateCount++;let r=new b(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){let l=qt(t,c=>x(c));o=ep(n.serverSyncTree_,r,l,s)}else{let l=x(t);o=pu(n.serverSyncTree_,r,l,s)}else if(i){let l=qt(t,c=>x(c));o=Jf(n.serverSyncTree_,r,l)}else{let l=x(t);o=En(n.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=Dt(n,r)),ie(n.eventQueue_,a,o)}function Ic(n,e){ho(n,"connected",e),e===!1&&Ip(n)}function Cp(n,e){U(e,(t,i)=>{ho(n,t,i)})}function ho(n,e,t){let i=new b("/.info/"+e),s=x(t);n.infoData_.updateSnapshot(i,s);let r=En(n.infoSyncTree_,i,s);ie(n.eventQueue_,i,r)}function zi(n){return n.nextWriteId_++}function wp(n,e,t){let i=tp(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(s=>{let r=x(s).withIndex(e._queryParams.getIndex());Er(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=En(n.serverSyncTree_,e._path,r);else{let a=pn(n.serverSyncTree_,e);o=pu(n.serverSyncTree_,e._path,r,a)}return ie(n.eventQueue_,e._path,o),Ri(n.serverSyncTree_,e,t,null,!0),r},s=>(Wt(n,"get for query "+O(e)+" failed: "+s),Promise.reject(new Error(s))))}function fo(n,e,t,i,s){Wt(n,"set",{path:e.toString(),value:t,priority:i});let r=Tn(n),o=x(t,i),a=Vi(n.serverSyncTree_,e),l=ao(o,a,r),c=zi(n),h=io(n.serverSyncTree_,e,l,c,!0);$i(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(d,p)=>{let g=d==="ok";g||B("set at "+e+" failed: "+d);let v=ke(n.serverSyncTree_,c,!g);ie(n.eventQueue_,e,v),Ue(n,s,d,p)});let u=_o(n,e);Dt(n,u),ie(n.eventQueue_,u,[])}function Ep(n,e,t,i){Wt(n,"update",{path:e.toString(),value:t});let s=!0,r=Tn(n),o={};if(U(t,(a,l)=>{s=!1,o[a]=yu(R(e,a),x(l),n.serverSyncTree_,r)}),s)L("update() called with empty data.  Don't do anything."),Ue(n,i,"ok",void 0);else{let a=zi(n),l=Yf(n.serverSyncTree_,e,o,a);$i(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,h)=>{let u=c==="ok";u||B("update at "+e+" failed: "+c);let d=ke(n.serverSyncTree_,a,!u),p=d.length>0?Dt(n,e):e;ie(n.eventQueue_,p,d),Ue(n,i,c,h)}),U(t,c=>{let h=_o(n,R(e,c));Dt(n,h)}),ie(n.eventQueue_,e,[])}}function Ip(n){Wt(n,"onDisconnectEvents");let e=Tn(n),t=Ci();cr(n.onDisconnect_,S(),(s,r)=>{let o=yu(s,r,n.serverSyncTree_,e);Ft(t,s,o)});let i=[];cr(t,S(),(s,r)=>{i=i.concat(En(n.serverSyncTree_,s,r));let o=_o(n,s);Dt(n,o)}),n.onDisconnect_=Ci(),ie(n.eventQueue_,S(),i)}function Sp(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,s)=>{i==="ok"&&lr(n.onDisconnect_,e),Ue(n,t,i,s)})}function Sc(n,e,t,i){let s=x(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(r,o)=>{r==="ok"&&Ft(n.onDisconnect_,e,s),Ue(n,i,r,o)})}function bp(n,e,t,i,s){let r=x(t,i);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&Ft(n.onDisconnect_,e,r),Ue(n,s,o,a)})}function Tp(n,e,t,i){if(Un(t)){L("onDisconnect().update() called with empty data.  Don't do anything."),Ue(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,r)=>{s==="ok"&&U(t,(o,a)=>{let l=x(a);Ft(n.onDisconnect_,R(e,o),l)}),Ue(n,i,s,r)})}function Ap(n,e,t){let i;C(e._path)===".info"?i=Er(n.infoSyncTree_,e,t):i=Er(n.serverSyncTree_,e,t),Su(n.eventQueue_,e._path,i)}function Nr(n,e,t){let i;C(e._path)===".info"?i=Ri(n.infoSyncTree_,e,t):i=Ri(n.serverSyncTree_,e,t),Su(n.eventQueue_,e._path,i)}function Nu(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Tu)}function Np(n){n.persistentConnection_&&n.persistentConnection_.resume(Tu)}function Wt(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),L(t,...e)}function Ue(n,e,t,i){e&&Mt(()=>{if(t==="ok")e(null);else{let s=(t||"error").toUpperCase(),r=s;i&&(r+=": "+i);let o=new Error(r);o.code=s,e(o)}})}function Pp(n,e,t,i,s,r){Wt(n,"transaction on "+e);let o={path:e,update:t,onComplete:i,status:null,order:Ac(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=po(n,e,void 0);o.currentInputSnapshot=a;let l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Sn("transaction failed: Data returned ",l,o.path),o.status=0;let c=qi(n.transactionQueueTree_,e),h=tt(c)||[];h.push(o),co(c,h);let u;typeof l=="object"&&l!==null&&oe(l,".priority")?(u=Pe(l,".priority"),f(gn(u),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):u=(Vi(n.serverSyncTree_,e)||y.EMPTY_NODE).getPriority().val();let d=Tn(n),p=x(l,u),g=ao(p,a,d);o.currentOutputSnapshotRaw=p,o.currentOutputSnapshotResolved=g,o.currentWriteId=zi(n);let v=io(n.serverSyncTree_,e,g,o.currentWriteId,o.applyLocally);ie(n.eventQueue_,e,v),Qi(n,n.transactionQueueTree_)}}function po(n,e,t){return Vi(n.serverSyncTree_,e,t)||y.EMPTY_NODE}function Qi(n,e=n.transactionQueueTree_){if(e||Yi(n,e),tt(e)){let t=Ru(n,e);f(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&Rp(n,In(e),t)}else vu(e)&&Hi(e,t=>{Qi(n,t)})}function Rp(n,e,t){let i=t.map(c=>c.currentWriteId),s=po(n,e,i),r=s,o=s.hash();for(let c=0;c<t.length;c++){let h=t[c];f(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;let u=q(e,h.path);r=r.updateChild(u,h.currentOutputSnapshotRaw)}let a=r.val(!0),l=e;n.server_.put(l.toString(),a,c=>{Wt(n,"transaction put response",{path:l.toString(),status:c});let h=[];if(c==="ok"){let u=[];for(let d=0;d<t.length;d++)t[d].status=2,h=h.concat(ke(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&u.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();Yi(n,qi(n.transactionQueueTree_,e)),Qi(n,n.transactionQueueTree_),ie(n.eventQueue_,e,h);for(let d=0;d<u.length;d++)Mt(u[d])}else{if(c==="datastale")for(let u=0;u<t.length;u++)t[u].status===3?t[u].status=4:t[u].status=0;else{B("transaction at "+l.toString()+" failed: "+c);for(let u=0;u<t.length;u++)t[u].status=4,t[u].abortReason=c}Dt(n,e)}},o)}function Dt(n,e){let t=Pu(n,e),i=In(t),s=Ru(n,t);return xp(n,s,i),i}function xp(n,e,t){if(e.length===0)return;let i=[],s=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=q(t,l.path),h=!1,u;if(f(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,u=l.abortReason,s=s.concat(ke(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=yp)h=!0,u="maxretry",s=s.concat(ke(n.serverSyncTree_,l.currentWriteId,!0));else{let d=po(n,l.path,o);l.currentInputSnapshot=d;let p=e[a].update(d.val());if(p!==void 0){Sn("transaction failed: Data returned ",p,l.path);let g=x(p);typeof p=="object"&&p!=null&&oe(p,".priority")||(g=g.updatePriority(d.getPriority()));let T=l.currentWriteId,J=Tn(n),_e=ao(g,d,J);l.currentOutputSnapshotRaw=g,l.currentOutputSnapshotResolved=_e,l.currentWriteId=zi(n),o.splice(o.indexOf(T),1),s=s.concat(io(n.serverSyncTree_,l.path,_e,l.currentWriteId,l.applyLocally)),s=s.concat(ke(n.serverSyncTree_,T,!0))}else h=!0,u="nodata",s=s.concat(ke(n.serverSyncTree_,l.currentWriteId,!0))}ie(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(u==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(u),!1,null))))}Yi(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Mt(i[a]);Qi(n,n.transactionQueueTree_)}function Pu(n,e){let t,i=n.transactionQueueTree_;for(t=C(e);t!==null&&tt(i)===void 0;)i=qi(i,t),e=N(e),t=C(e);return i}function Ru(n,e){let t=[];return xu(n,e,t),t.sort((i,s)=>i.order-s.order),t}function xu(n,e,t){let i=tt(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);Hi(e,s=>{xu(n,s,t)})}function Yi(n,e){let t=tt(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,co(e,t.length>0?t:void 0)}Hi(e,i=>{Yi(n,i)})}function _o(n,e){let t=In(Pu(n,e)),i=qi(n.transactionQueueTree_,e);return up(i,s=>{Ls(n,s)}),Ls(n,i),Cu(i,s=>{Ls(n,s)}),t}function Ls(n,e){let t=tt(e);if(t){let i=[],s=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(f(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(f(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(ke(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?co(e,void 0):t.length=r+1,ie(n.eventQueue_,In(e),s);for(let o=0;o<i.length;o++)Mt(i[o])}}function kp(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function Dp(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):B(`Invalid query segment '${t}' in query '${n}'`)}return e}var Pr=function(n,e){let t=Op(n),i=t.namespace;t.domain==="firebase.com"&&Ee(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&Ee("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||cd();let s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new di(t.host,t.secure,i,s,e,"",i!==t.subdomain),path:new b(t.pathString)}},Op=function(n){let e="",t="",i="",s="",r="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let h=n.indexOf("/");h===-1&&(h=n.length);let u=n.indexOf("?");u===-1&&(u=n.length),e=n.substring(0,Math.min(h,u)),h<u&&(s=kp(n.substring(h,u)));let d=Dp(n.substring(Math.min(n.length,u)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let p=e.slice(0,c);if(p.toLowerCase()==="localhost")t="localhost";else if(p.split(".").length<=2)t=p;else{let g=e.indexOf(".");i=e.substring(0,g).toLowerCase(),t=e.substring(g+1),r=i}"ns"in d&&(r=d.ns)}return{host:e,port:l,domain:t,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};var bc="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Mp=function(){let n=0,e=[];return function(t){let i=t===n;n=t;let s,r=new Array(8);for(s=7;s>=0;s--)r[s]=bc.charAt(t%64),t=Math.floor(t/64);f(t===0,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=bc.charAt(e[s]);return f(o.length===20,"nextPushId: Length should be 20."),o}}();var xi=class{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+O(this.snapshot.exportVal())}},ki=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var mn=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Di=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new V;return Sp(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){ne("OnDisconnect.remove",this._path);let e=new V;return Sc(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){ne("OnDisconnect.set",this._path),Se("OnDisconnect.set",e,this._path,!1);let t=new V;return Sc(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){ne("OnDisconnect.setWithPriority",this._path),Se("OnDisconnect.setWithPriority",e,this._path,!1),uo("OnDisconnect.setWithPriority",t,!1);let i=new V;return bp(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){ne("OnDisconnect.update",this._path),Eu("OnDisconnect.update",e,this._path,!1);let t=new V;return Tp(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var K=class n{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return w(this._path)?null:Kr(this._path)}get ref(){return new se(this._repo,this._path)}get _queryIdentifier(){let e=hc(this._queryParams),t=qr(e);return t==="{}"?"default":t}get _queryObject(){return hc(this._queryParams)}isEqual(e){if(e=W(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=$r(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+jd(this._path)}};function Ji(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Be(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===we){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Me)throw new Error(i);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==Ae)throw new Error(i);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===P){if(e!=null&&!gn(e)||t!=null&&!gn(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(f(n.getIndex()instanceof an||n.getIndex()===Yr,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Xi(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var se=class n extends K{constructor(e,t){super(e,t,new hn,!1)}get parent(){let e=zc(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Ot=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new b(e),i=We(this.ref,e);return new n(this._node.getChild(t),i,P)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new n(s,We(this.ref,i),P)))}hasChild(e){let t=new b(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function go(n,e){return n=W(n),n._checkNotDeleted("ref"),e!==void 0?We(n._root,e):n._root}function mo(n,e){n=W(n),n._checkNotDeleted("refFromURL");let t=Pr(e,n._repo.repoInfo_.nodeAdmin);Iu("refFromURL",t);let i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&Ee("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),go(n,t.path.toString())}function We(n,e){return n=W(n),C(n._path)===null?gp("child","path",e,!1):Ut("child","path",e,!1),new se(n._repo,R(n._path,e))}function ku(n,e){n=W(n),ne("push",n._path),Se("push",e,n._path,!0);let t=Au(n._repo),i=Mp(t),s=We(n,i),r=We(n,i),o;return e!=null?o=Zi(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Du(n){return ne("remove",n._path),Zi(n,null)}function Zi(n,e){n=W(n),ne("set",n._path),Se("set",e,n._path,!1);let t=new V;return fo(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Ou(n,e){n=W(n),ne("setPriority",n._path),uo("setPriority",e,!1);let t=new V;return fo(n._repo,R(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function Mu(n,e,t){if(ne("setWithPriority",n._path),Se("setWithPriority",e,n._path,!1),uo("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let i=new V;return fo(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function Fu(n,e){Eu("update",e,n._path,!1);let t=new V;return Ep(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Lu(n){n=W(n);let e=new mn(()=>{}),t=new yn(e);return wp(n._repo,n,t).then(i=>new Ot(i,new se(n._repo,n._path),n._queryParams.getIndex()))}var yn=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new xi("value",this,new Ot(e.snapshotNode,new se(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ki(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Oi=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ki(this,e,t):null}createEvent(e,t){f(e.childName!=null,"Child events should have a childName.");let i=We(new se(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new xi(e.type,this,new Ot(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function An(n,e,t,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){let l=t,c=(h,u)=>{Nr(n._repo,n,a),l(h,u)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new mn(t,r||void 0),a=e==="value"?new yn(o):new Oi(e,o);return Ap(n._repo,n,a),()=>Nr(n._repo,n,a)}function es(n,e,t,i){return An(n,"value",e,t,i)}function yo(n,e,t,i){return An(n,"child_added",e,t,i)}function vo(n,e,t,i){return An(n,"child_changed",e,t,i)}function Co(n,e,t,i){return An(n,"child_moved",e,t,i)}function wo(n,e,t,i){return An(n,"child_removed",e,t,i)}function Eo(n,e,t){let i=null,s=t?new mn(t):null;e==="value"?i=new yn(s):e&&(i=new Oi(e,s)),Nr(n._repo,n,i)}var re=class{},Mi=class extends re{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Se("endAt",this._value,e._path,!0);let t=rr(e._queryParams,this._value,this._key);if(Xi(t),Be(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new K(e._repo,e._path,t,e._orderByCalled)}};function Uu(n,e){return bn("endAt","key",e,!0),new Mi(n,e)}var Rr=class extends re{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Se("endBefore",this._value,e._path,!1);let t=af(e._queryParams,this._value,this._key);if(Xi(t),Be(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new K(e._repo,e._path,t,e._orderByCalled)}};function Wu(n,e){return bn("endBefore","key",e,!0),new Rr(n,e)}var Fi=class extends re{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Se("startAt",this._value,e._path,!0);let t=sr(e._queryParams,this._value,this._key);if(Xi(t),Be(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new K(e._repo,e._path,t,e._orderByCalled)}};function Bu(n=null,e){return bn("startAt","key",e,!0),new Fi(n,e)}var xr=class extends re{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Se("startAfter",this._value,e._path,!1);let t=of(e._queryParams,this._value,this._key);if(Xi(t),Be(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new K(e._repo,e._path,t,e._orderByCalled)}};function ju(n,e){return bn("startAfter","key",e,!0),new xr(n,e)}var kr=class extends re{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new K(e._repo,e._path,sf(e._queryParams,this._limit),e._orderByCalled)}};function Vu(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new kr(n)}var Dr=class extends re{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new K(e._repo,e._path,rf(e._queryParams,this._limit),e._orderByCalled)}};function Gu(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Dr(n)}var Or=class extends re{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Ji(e,"orderByChild");let t=new b(this._path);if(w(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let i=new an(t),s=Ui(e._queryParams,i);return Be(s),new K(e._repo,e._path,s,!0)}};function qu(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Ut("orderByChild","path",n,!1),new Or(n)}var Mr=class extends re{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Ji(e,"orderByKey");let t=Ui(e._queryParams,we);return Be(t),new K(e._repo,e._path,t,!0)}};function Hu(){return new Mr}var Fr=class extends re{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Ji(e,"orderByPriority");let t=Ui(e._queryParams,P);return Be(t),new K(e._repo,e._path,t,!0)}};function Ku(){return new Fr}var Lr=class extends re{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Ji(e,"orderByValue");let t=Ui(e._queryParams,Yr);return Be(t),new K(e._repo,e._path,t,!0)}};function $u(){return new Lr}var Ur=class extends re{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Se("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Mi(this._value,this._key)._apply(new Fi(this._value,this._key)._apply(e))}};function zu(n,e){return bn("equalTo","key",e,!0),new Ur(n,e)}function ue(n,...e){let t=W(n);for(let i of e)t=i._apply(t);return t}Vf(se);$f(se);var Fp="FIREBASE_DATABASE_EMULATOR_HOST",Wr={},Lp=!1;function Up(n,e,t,i){n.repoInfo_=new di(e,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),i&&(n.authTokenProvider_=i)}function Io(n,e,t,i,s){let r=i||n.options.databaseURL;r===void 0&&(n.options.projectId||Ee("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),L("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Pr(r,s),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[Fp]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=Pr(r,s),a=o.repoInfo):l=!o.repoInfo.secure;let h=s&&l?new en(en.OWNER):new Gs(n.name,n.options,e);Iu("Invalid Firebase Database URL",o),w(o.path)||Ee("Database URL must point to the root of a Firebase Database (not including a child path).");let u=Bp(a,n,h,new Vs(n,t));return new Br(u,n)}function Wp(n,e){let t=Wr[e];(!t||t[n.key]!==n)&&Ee(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Nu(n),delete t[n.key]}function Bp(n,e,t,i){let s=Wr[e.name];s||(s={},Wr[e.name]=s);let r=s[n.toURLString()];return r&&Ee("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Ar(n,Lp,t,i),s[n.toURLString()]=r,r}var Br=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(vp(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new se(this._repo,S())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Wp(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Ee("Cannot call "+e+" on a deleted database.")}};function Qu(){$c.IS_TRANSPORT_INITIALIZED&&B("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Yu(){Qu(),rn.forceDisallow()}function Ju(){Qu(),St.forceDisallow(),rn.forceAllow()}function Xu(n,e,t,i={}){n=W(n),n._checkNotDeleted("useEmulator");let s=`${e}:${t}`,r=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&ua(i,r.repoInfo_.emulatorOptions))return;Ee("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&Ee('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new en(en.OWNER);else if(i.mockUserToken){let a=typeof i.mockUserToken=="string"?i.mockUserToken:oa(i.mockUserToken,n.app.options.projectId);o=new en(a)}Up(r,s,i,o)}function Zu(n){n=W(n),n._checkNotDeleted("goOffline"),Nu(n._repo)}function eh(n){n=W(n),n._checkNotDeleted("goOnline"),Np(n._repo)}function th(n,e){Pc(n,e)}function jp(n){Gr(ma),_a(new Re("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Io(i,s,r,t)},"PUBLIC").setMultipleInstances(!0)),Kt(zl,Ql,n),Kt(zl,Ql,"esm2017")}var Vp={".sv":"timestamp"};function nh(){return Vp}function ih(n){return{".sv":{increment:n}}}var jr=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function sh(n,e,t){var i;if(n=W(n),ne("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let s=(i=t?.applyLocally)!==null&&i!==void 0?i:!0,r=new V,o=(l,c,h)=>{let u=null;l?r.reject(l):(u=new Ot(h,new se(n._repo,n._path),P),r.resolve(new jr(c,u)))},a=es(n,()=>{});return Pp(n._repo,n._path,e,o,a,s),r.promise}zr.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};zr.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};jp();var Gp="@firebase/database-compat",qp="2.0.5";var Hp=new Bn("@firebase/database-compat"),rh=function(n){let e="FIREBASE WARNING: "+n;Hp.warn(e)};var Kp=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error(Y(n,e)+"must be a boolean.")},$p=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Y(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var So=class{constructor(e){this._delegate=e}cancel(e){m("OnDisconnect.cancel",0,1,arguments.length),M("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){m("OnDisconnect.remove",0,1,arguments.length),M("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){m("OnDisconnect.set",1,2,arguments.length),M("OnDisconnect.set","onComplete",t,!0);let i=this._delegate.set(e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){m("OnDisconnect.setWithPriority",2,3,arguments.length),M("OnDisconnect.setWithPriority","onComplete",i,!0);let s=this._delegate.setWithPriority(e,t);return i&&s.then(()=>i(null),r=>i(r)),s}update(e,t){if(m("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,rh("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}M("OnDisconnect.update","onComplete",t,!0);let i=this._delegate.update(e);return t&&i.then(()=>t(null),s=>t(s)),i}};var bo=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return m("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var nt=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return m("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return m("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return m("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return m("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return m("DataSnapshot.child",0,1,arguments.length),e=String(e),Ut("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return m("DataSnapshot.hasChild",1,1,arguments.length),Ut("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return m("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return m("DataSnapshot.forEach",1,1,arguments.length),M("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return m("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return m("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return m("DataSnapshot.ref",0,0,arguments.length),new Ne(this._database,this._delegate.ref)}get ref(){return this.getRef()}},ts=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,s){var r;m("Query.on",2,4,arguments.length),M("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",i,s),a=(c,h)=>{t.call(o.context,new nt(this.database,c),h)};a.userCallback=t,a.context=o.context;let l=(r=o.cancel)===null||r===void 0?void 0:r.bind(o.context);switch(e){case"value":return es(this._delegate,a,l),t;case"child_added":return yo(this._delegate,a,l),t;case"child_removed":return wo(this._delegate,a,l),t;case"child_changed":return vo(this._delegate,a,l),t;case"child_moved":return Co(this._delegate,a,l),t;default:throw new Error(Y("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if(m("Query.off",0,3,arguments.length),$p("Query.off",e,!0),M("Query.off","callback",t,!0),hs("Query.off","context",i,!0),t){let s=()=>{};s.userCallback=t,s.context=i,Eo(this._delegate,e,s)}else Eo(this._delegate,e)}get(){return Lu(this._delegate).then(e=>new nt(this.database,e))}once(e,t,i,s){m("Query.once",1,4,arguments.length),M("Query.once","callback",t,!0);let r=n.getCancelAndContextArgs_("Query.once",i,s),o=new V,a=(c,h)=>{let u=new nt(this.database,c);t&&t.call(r.context,u,h),o.resolve(u)};a.userCallback=t,a.context=r.context;let l=c=>{r.cancel&&r.cancel.call(r.context,c),o.reject(c)};switch(e){case"value":es(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":yo(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":wo(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":vo(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":Co(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error(Y("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return m("Query.limitToFirst",1,1,arguments.length),new n(this.database,ue(this._delegate,Vu(e)))}limitToLast(e){return m("Query.limitToLast",1,1,arguments.length),new n(this.database,ue(this._delegate,Gu(e)))}orderByChild(e){return m("Query.orderByChild",1,1,arguments.length),new n(this.database,ue(this._delegate,qu(e)))}orderByKey(){return m("Query.orderByKey",0,0,arguments.length),new n(this.database,ue(this._delegate,Hu()))}orderByPriority(){return m("Query.orderByPriority",0,0,arguments.length),new n(this.database,ue(this._delegate,Ku()))}orderByValue(){return m("Query.orderByValue",0,0,arguments.length),new n(this.database,ue(this._delegate,$u()))}startAt(e=null,t){return m("Query.startAt",0,2,arguments.length),new n(this.database,ue(this._delegate,Bu(e,t)))}startAfter(e=null,t){return m("Query.startAfter",0,2,arguments.length),new n(this.database,ue(this._delegate,ju(e,t)))}endAt(e=null,t){return m("Query.endAt",0,2,arguments.length),new n(this.database,ue(this._delegate,Uu(e,t)))}endBefore(e=null,t){return m("Query.endBefore",0,2,arguments.length),new n(this.database,ue(this._delegate,Wu(e,t)))}equalTo(e,t){return m("Query.equalTo",1,2,arguments.length),new n(this.database,ue(this._delegate,zu(e,t)))}toString(){return m("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return m("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(m("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){let s={cancel:void 0,context:void 0};if(t&&i)s.cancel=t,M(e,"cancel",s.cancel,!0),s.context=i,hs(e,"context",s.context,!0);else if(t)if(typeof t=="object"&&t!==null)s.context=t;else if(typeof t=="function")s.cancel=t;else throw new Error(Y(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return s}get ref(){return new Ne(this.database,new se(this._delegate._repo,this._delegate._path))}},Ne=class n extends ts{constructor(e,t){super(e,new K(t._repo,t._path,new hn,!1)),this.database=e,this._delegate=t}getKey(){return m("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return m("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,We(this._delegate,e))}getParent(){m("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return m("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){m("Reference.set",1,2,arguments.length),M("Reference.set","onComplete",t,!0);let i=Zi(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}update(e,t){if(m("Reference.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,rh("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ne("Reference.update",this._delegate._path),M("Reference.update","onComplete",t,!0);let i=Fu(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){m("Reference.setWithPriority",2,3,arguments.length),M("Reference.setWithPriority","onComplete",i,!0);let s=Mu(this._delegate,e,t);return i&&s.then(()=>i(null),r=>i(r)),s}remove(e){m("Reference.remove",0,1,arguments.length),M("Reference.remove","onComplete",e,!0);let t=Du(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){m("Reference.transaction",1,3,arguments.length),M("Reference.transaction","transactionUpdate",e,!1),M("Reference.transaction","onComplete",t,!0),Kp("Reference.transaction","applyLocally",i,!0);let s=sh(this._delegate,e,{applyLocally:i}).then(r=>new bo(r.committed,new nt(this.database,r.snapshot)));return t&&s.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),s}setPriority(e,t){m("Reference.setPriority",1,2,arguments.length),M("Reference.setPriority","onComplete",t,!0);let i=Ou(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}push(e,t){m("Reference.push",0,2,arguments.length),M("Reference.push","onComplete",t,!0);let i=ku(this._delegate,e),s=i.then(o=>new n(this.database,o));t&&s.then(()=>t(null),o=>t(o));let r=new n(this.database,i);return r.then=s.then.bind(s),r.catch=s.catch.bind(s,void 0),r}onDisconnect(){return ne("Reference.onDisconnect",this._delegate._path),new So(new Di(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var it=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Yu,forceLongPolling:Ju}}useEmulator(e,t,i={}){Xu(this._delegate,e,t,i)}ref(e){if(m("database.ref",0,1,arguments.length),e instanceof Ne){let t=mo(this._delegate,e.toString());return new Ne(this,t)}else{let t=go(this._delegate,e);return new Ne(this,t)}}refFromURL(e){m("database.refFromURL",1,1,arguments.length);let i=mo(this._delegate,e);return new Ne(this,i)}goOffline(){return m("database.goOffline",0,0,arguments.length),Zu(this._delegate)}goOnline(){return m("database.goOnline",0,0,arguments.length),eh(this._delegate)}};it.ServerValue={TIMESTAMP:nh(),increment:n=>ih(n)};function zp({app:n,url:e,version:t,customAuthImpl:i,customAppCheckImpl:s,namespace:r,nodeAdmin:o=!1}){Gr(t);let a=new ds("database-standalone"),l=new Wn("auth-internal",a);l.setComponent(new Re("auth-internal",()=>i,"PRIVATE"));let c;return s&&(c=new Wn("app-check-internal",a),c.setComponent(new Re("app-check-internal",()=>s,"PRIVATE"))),{instance:new it(Io(n,l,c,e,o),n),namespace:r}}var Qp=Object.freeze({__proto__:null,initStandalone:zp});var Yp=it.ServerValue;function Jp(n){n.INTERNAL.registerComponent(new Re("database-compat",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app-compat").getImmediate(),s=e.getProvider("database").getImmediate({identifier:t});return new it(s,i)},"PUBLIC").setServiceProps({Reference:Ne,Query:ts,Database:it,DataSnapshot:nt,enableLogging:th,INTERNAL:Qp,ServerValue:Yp}).setMultipleInstances(!0)),n.registerVersion(Gp,qp)}Jp(ae);function Nn(n,e,t="on",i=xn){return new Rn(s=>{let r=null;return r=n[t](e,(o,a)=>{i.schedule(()=>{s.next({snapshot:o,prevKey:a})}),t==="once"&&i.schedule(()=>s.complete())},o=>{i.schedule(()=>s.error(o))}),t==="on"?{unsubscribe(){r!=null&&n.off(e,r)}}:{unsubscribe(){}}}).pipe(A(s=>{let{snapshot:r,prevKey:o}=s,a=null;return r.exists()&&(a=r.key),{type:e,payload:r,prevKey:o,key:a}}),Mo())}function Xp(n){return typeof n=="string"}function Zp(n){return typeof n.exportVal=="function"}function uh(n){return n==null}function hh(n){return typeof n.set=="function"}function oh(n,e){return hh(e)?e:n.ref(e)}function dh(n,e){if(Xp(n))return e.stringCase();if(hh(n))return e.firebaseCase();if(Zp(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function fh(n){return(uh(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function ph(n,e,t){e=fh(e);let i=e.map(s=>Nn(n,s,"on",t));return rs(...i)}function e_(n,e,t){let i=ph(n,e).pipe(je((s,r)=>[...s,r],[]));return n_(n,i,t)}function t_(n,e){return Nn(n,"value","on",e).pipe(A(t=>{let i;return t.payload.forEach(s=>(i=s.key,!1)),{data:t,lastKeyToLoad:i}}))}function n_(n,e,t){return t_(n,t).pipe(Uo(e),A(([s,r])=>{let o=s.lastKeyToLoad,a=r.map(l=>l.key);return{actions:r,lastKeyToLoad:o,loadedKeys:a}}),Lo(s=>s.loadedKeys.indexOf(s.lastKeyToLoad)===-1),A(s=>s.actions))}function ah(n,e){return function(i,s){return dh(i,{stringCase:()=>n.child(i)[e](s),firebaseCase:()=>i[e](s),snapshotCase:()=>i.ref[e](s)})}}function i_(n){return function(t){return t?dh(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function s_(n,e,t){return Nn(n,"value","once",t).pipe(be(i=>{let s=[Z(i)];return e.forEach(r=>s.push(Nn(n,r,"on",t))),rs(...s).pipe(je(o_,[]))}),at())}function _h(n,e){let t=n.length;for(let i=0;i<t;i++)if(n[i].payload.key===e)return i;return-1}function r_(n,e){if(uh(e))return 0;{let t=_h(n,e);return t===-1?n.length:t+1}}function o_(n,e){let{payload:t,prevKey:i,key:s}=e,r=_h(n,s),o=r_(n,i);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(l=>{let c={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,c],!1})}return n;case"child_added":if(r>-1)(n[r-1]?.key||null)!==i&&(n=n.filter(l=>l.payload.key!==t.key),n.splice(o,0,e));else{if(i==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===s?e:a);case"child_moved":if(r>-1){let a=n.splice(r,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function lh(n,e,t){return e=fh(e),s_(n,e,t)}function a_(n,e,t){let i=e.schedulers.outsideAngular,s=de(j).run(()=>n.ref);return{query:n,update:ah(s,"update"),set:ah(s,"set"),push:r=>s.push(r),remove:i_(s),snapshotChanges(r){return lh(n,r,i).pipe(F(t))},stateChanges(r){return ph(n,r,i).pipe(F(t))},auditTrail(r){return e_(n,r,i).pipe(F(t))},valueChanges(r,o){return lh(n,r,i).pipe(A(l=>l.map(c=>o&&o.idField?ge(X({},c.payload.val()),{[o.idField]:c.key}):c.payload.val())),F(t))}}}function ch(n,e){return function(){return Nn(n,"value","on",e)}}function l_(n,e,t){return{query:n,snapshotChanges(){return ch(n,e.schedulers.outsideAngular)().pipe(F(t))},update(i){return n.ref.update(i)},set(i){return n.ref.set(i)},remove(){return n.ref.remove()},valueChanges(){return ch(n,e.schedulers.outsideAngular)().pipe(F(t),A(s=>s.payload.exists()?s.payload.val():null))}}}var c_=new $("angularfire2.realtimeDatabaseURL"),u_=new $("angularfire2.database.use-emulator"),h_=(()=>{class n{schedulers;database;injector=de(ut);constructor(t,i,s,r,o,a,l,c,h,u,d,p,g,v,T){this.schedulers=a;let J=l,_e=qn(t,o,i);c&&Jn(_e,o,h,d,p,g,u,v),this.database=gt(`${_e.name}.database.${s}`,"AngularFireDatabase",_e.name,()=>{let he=o.runOutsideAngular(()=>_e.database(s||void 0));return J&&he.useEmulator(...J),he},[J])}list(t,i){let s=de(j).runOutsideAngular(()=>oh(this.database,t)),r=s;return i&&(r=i(s)),a_(r,this,this.injector)}object(t){let i=de(j).runOutsideAngular(()=>oh(this.database,t));return l_(i,this,this.injector)}createPushId(){return de(j).runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(i){return new(i||n)(_(Vn),_(Gn,8),_(c_,8),_(Ge),_(j),_(_t),_(u_,8),_(mt,8),_(Hn,8),_(Kn,8),_($n,8),_(zn,8),_(Qn,8),_(Yn,8),_(jn,8))};static \u0275prov=me({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),gh=(()=>{class n{constructor(){ae.registerVersion("angularfire",xe.full,"rtdb-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=qe({type:n});static \u0275inj=Ve({providers:[h_]})}return n})();var d_="firebase_event_origin",f_="firebase_previous_class",p_="firebase_previous_id",__="firebase_previous_screen",g_="firebase_screen_class",mh="firebase_screen_id",m_="firebase_screen",Ao="outlet",y_="page_path",v_="page_title",Pn="screen_class",yh="screen_name";var C_="auto",w_="#",E_=Math.floor(Math.random()*(2**32-1))-2**31,To={},I_=n=>{let e=[n[Pn],n[Ao]].join(w_);if(To.hasOwnProperty(e))return To[e];{let t=E_++;return To[e]=t,t}},vh=(n,e,t)=>n.events.pipe(ot(s=>s instanceof Jo)).pipe(be(s=>{let o=n.parseUrl(n.url.replace(/(?:\().+(?:\))/g,d=>d.replace("://",":///"))).root.children[s.snapshot.outlet]?.toString()||"",a=n.routerState.root.children.map(d=>d).find(d=>d.outlet===s.snapshot.outlet);if(!a)return Z(null);let l=a;for(;l.firstChild;)l=l.firstChild;let c=l.pathFromRoot.map(d=>d.routeConfig?.path).filter(d=>d).join("/")||"/",h={[yh]:c,[y_]:`/${o}`,[d_]:C_,[m_]:c,[Ao]:s.snapshot.outlet};e&&(h[v_]=e.getTitle());let u=a.component;if(u){if(u===Xo){let d=s.snapshot;for(;d.firstChild;)d=d.firstChild;u=d.component}}else u=s.snapshot.component;if(typeof u=="string")return Z(ge(X({},h),{[Pn]:u}));if(u){let d=t.resolveComponentFactory(u);return Z(ge(X({},h),{[Pn]:d.selector}))}return Z(null)}),ot(s=>!!s),A(s=>X({[g_]:s[Pn],[mh]:I_(s)},s)),Oo(s=>s[Ao]),ko(s=>s.pipe(at((r,o)=>JSON.stringify(r)===JSON.stringify(o)),ct(void 0),lt(),A(([r,o])=>r?X({[f_]:r[Pn],[__]:r[yh],[p_]:r[mh]},o):o))));var S_=new $("angularfire2.analytics.analyticsCollectionEnabled"),b_=new $("angularfire2.analytics.appVersion"),T_=new $("angularfire2.analytics.appName"),A_=new $("angularfire2.analytics.debugMode"),N_=new $("angularfire2.analytics.config"),P_="app_name",R_="app_version",x_="debug_mode",k_="config",Ch="gtag",ns="dataLayer",D_="send_to",is=(()=>{class n{measurementId;analyticsInitialized=new Promise(()=>{});updateConfig(t){return st(this,null,function*(){yield this.analyticsInitialized,window[Ch](k_,this.measurementId,ge(X({},t),{update:!0}))})}constructor(t,i,s,r,o,a,l,c,h){if(cs(l)){window[ns]=window[ns]||[];let d=(...v)=>v[0]==="config"&&v[2].origin==="firebase"?(this.measurementId=v[1],!0):!1,p=v=>{window[Ch]=(...T)=>{v&&v(...T),T[0]==="event"&&T[2][D_]===this.measurementId&&(r&&(T[2][P_]=r),s&&(T[2][R_]=s)),o&&typeof console<"u"&&console.info(...T),function(...J){window[ns].push(arguments)}(...T)}};window[ns].some(d)?(this.analyticsInitialized=Promise.resolve(),p()):this.analyticsInitialized=new Promise(v=>{p((...T)=>{d(...T)&&v()})}),a&&this.updateConfig(a),o&&this.updateConfig({[x_]:1})}else this.analyticsInitialized=Promise.resolve();let u=Z(void 0).pipe(xo(h.outsideAngular),be(ws),be(d=>d?c.runOutsideAngular(()=>import("./chunk-IQ5WKHL3.js")):Ro),A(()=>gt("analytics","AngularFireAnalytics",t.name,()=>{let d=t.analytics();return i===!1&&d.setAnalyticsCollectionEnabled(!1),d},[t,i,a,o])),Fo({bufferSize:1,refCount:!1}));return ba(this,u,c)}static \u0275fac=function(i){return new(i||n)(_(Ta),_(S_,8),_(b_,8),_(T_,8),_(A_,8),_(N_,8),_(Ge),_(j),_(_t))};static \u0275prov=me({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),wh=(()=>{class n{initialized;disposables=[];constructor(t,i,s,r){if(ae.registerVersion("angularfire",xe.full,"compat-user-tracking"),cs(i)){let o;this.initialized=r.runOutsideAngular(()=>new Promise(a=>o=a)),this.disposables=[s.authState.subscribe(a=>{t.setUserId(a?.uid),o()}),s.credential.subscribe(a=>{if(a){let l=a.user.isAnonymous?"anonymous":a.additionalUserInfo.providerId;a.additionalUserInfo.isNewUser&&t.logEvent("sign_up",{method:l}),t.logEvent("login",{method:l})}})]}else this.initialized=Promise.resolve()}ngOnDestroy(){this.disposables.forEach(t=>t.unsubscribe())}static \u0275fac=function(i){return new(i||n)(_(is),_(Ge),_(mt),_(j))};static \u0275prov=me({token:n,factory:n.\u0275fac})}return n})(),O_="screen_view",M_=(()=>{class n{disposable;constructor(t,i,s,r,o,a){if(ae.registerVersion("angularfire",xe.full,"compat-screen-tracking"),!i||!t)return this;o.runOutsideAngular(()=>{this.disposable=vh(i,s,r).pipe(be(l=>st(this,null,function*(){return a&&(yield a.initialized),yield t.logEvent(O_,l)}))).subscribe()})}ngOnDestroy(){this.disposable&&this.disposable.unsubscribe()}static \u0275fac=function(i){return new(i||n)(_(is),_(ft,8),_(Yo,8),_(Bo),_(j),_(wh,8))};static \u0275prov=me({token:n,factory:n.\u0275fac})}return n})(),Eh=(()=>{class n{constructor(t,i,s){ae.registerVersion("angularfire",xe.full,"analytics-compat"),t.app.then(()=>{})}static \u0275fac=function(i){return new(i||n)(_(is),_(M_,8),_(wh,8))};static \u0275mod=qe({type:n});static \u0275inj=Ve({providers:[is]})}return n})();var Ih={apiKey:"AIzaSyAWloYkL32zXQ09Io2tHnxcyvk0VRCtGsk",authDomain:"axicars-d49dd.firebaseapp.com",projectId:"axicars-d49dd",storageBucket:"axicars-d49dd.appspot.com",messagingSenderId:"912196126101",appId:"1:912196126101:web:7fa680d4178f9022fae29c",measurementId:"G-F68BTX5V0M"},Sh={providers:[Go({eventCoalescing:!0}),zo(),ya(()=>va(Ih)),wa(()=>Ia()),Tl(()=>Al()),ta(Ol),Wo([Aa.initializeApp(Ih),Na,$l,gh,Eh])]};var ss=class n{title="axiCars";ngOninit(){}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=ht({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(t,i){t&1&&D(0,"router-outlet")},dependencies:[Fn],encapsulation:2})};Qo(ss,Sh).catch(n=>console.error(n));
